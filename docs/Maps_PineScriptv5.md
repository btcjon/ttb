-   [Introduction](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#introduction)
-   [Declaring a map](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#declaring-a-map)
    -   [Using \`var\` and \`varip\` keywords](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#using-var-and-varip-keywords)
-   [Reading and writing](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#reading-and-writing)
    -   [Putting and getting key-value pairs](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#putting-and-getting-key-value-pairs)
    -   [Inspecting keys and values](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#inspecting-keys-and-values)
        -   [\`map.keys()\` and \`map.values()\`](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#map-keys-and-map-values)
        -   [\`map.contains()\`](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#map-contains)
    -   [Removing key-value pairs](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#removing-key-value-pairs)
    -   [Combining maps](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#combining-maps)
-   [Looping through a map](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#looping-through-a-map)
-   [Copying a map](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#copying-a-map)
    -   [Shallow copies](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#shallow-copies)
    -   [Deep copies](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#deep-copies)
-   [Scope and history](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#scope-and-history)
-   [Maps of other collections](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#maps-of-other-collections)

Note

This page contains advanced material. If you are a beginning Pine Script™ programmer, we recommend you become familiar with other, more accessible Pine Script™ features before you venture here.

## [Introduction](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id1)

Pine Script™ Maps are collections that store elements in _key-value pairs_. They allow scripts to collect multiple value references associated with unique identifiers (keys).

Unlike [arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#pagearrays) and [matrices](https://www.tradingview.com/pine-script-docs/en/v5/language/Matrices.html#pagematrices), maps are considered _unordered_ collections. Scripts quickly access a map’s values by referencing the keys from the key-value pairs put into them rather than traversing an internal index.

A map’s keys can be of any _fundamental type_, and its values can be of any built-in or [user-defined](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-userdefinedtypes) type. Maps cannot directly use other _collections_ (maps, [arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#pagearrays), or [matrices](https://www.tradingview.com/pine-script-docs/en/v5/language/Matrices.html#pagematrices)) as values, but they can hold [UDT](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-userdefinedtypes) instances containing these data structures within their fields. See [this section](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#pagemaps-mapsofothercollections) for more information.

As with other collections, maps can contain up to 100,000 elements in total. Since each key-value pair in a map consists of two elements (a unique _key_ and its associated _value_), the maximum number of key-value pairs a map can hold is 50,000.

## [Declaring a map](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id2)

Pine Script™ uses the following syntax to declare maps:

```
<span><span>[</span><span>var/varip</span><span>&nbsp;</span><span>][</span><span>map</span><span>&lt;</span><span>keyType</span><span>,</span><span>&nbsp;</span><span>valueType</span><span>&gt;</span><span>&nbsp;</span><span>]</span><span>&lt;</span><span>identifier</span><span>&gt;</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>&lt;</span><span>expression</span><span>&gt;</span></span><br><span><span></span></span><br>
```

Where `<keyType, valueType>` is the map’s [type template](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-typetemplates) that declares the types of keys and values it will contain, and the `<expression>` returns either a map instance or `na`.

When declaring a map variable assigned to `na`, users must include the [map](https://www.tradingview.com/pine-script-reference/v5/#type_map) keyword followed by a [type template](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-typetemplates) to tell the compiler that the variable can accept maps with `keyType` keys and `valueType` values.

For example, this line of code declares a new `myMap` variable that can accept map instances holding pairs of [string](https://www.tradingview.com/pine-script-reference/v5/#type_string) keys and [float](https://www.tradingview.com/pine-script-reference/v5/#type_float) values:

```
<span><span>map</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>myMap</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>na</span></span><br><span><span></span></span><br>
```

When the `<expression>` is not `na`, the compiler does not require explicit type declaration, as it will infer the type information from the assigned map object.

This line declares a `myMap` variable assigned to an empty map with [string](https://www.tradingview.com/pine-script-reference/v5/#type_string) keys and [float](https://www.tradingview.com/pine-script-reference/v5/#type_float) values. Any maps assigned to this variable later must have the same key and value types:

```
<span><span>myMap</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;()</span></span><br><span><span></span></span><br>
```

### [Using \`var\` and \`varip\` keywords](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id3)

Users can include the [var](https://www.tradingview.com/pine-script-reference/v5/#kw_var) or [varip](https://www.tradingview.com/pine-script-reference/v5/#kw_varip) keywords to instruct their scripts to declare map variables only on the first chart bar. Variables that use these keywords point to the same map instances on each script iteration until explicitly reassigned.

For example, this script declares a `colorMap` variable assigned to a map that holds pairs of [string](https://www.tradingview.com/pine-script-reference/v5/#type_string) keys and [color](https://www.tradingview.com/pine-script-reference/v5/#type_color) values on the first chart bar. The script displays an `oscillator` on the chart and uses the values it [put](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put) into the `colorMap` on the _first_ bar to color the plots on _all_ bars:

![../_images/Maps-Declaring-a-map-Using-var-and-varip-keywords-1.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Declaring-a-map-Using-var-and-varip-keywords-1.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"var&nbsp;map&nbsp;demo"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;associating&nbsp;color&nbsp;values&nbsp;with&nbsp;string&nbsp;keys.</span></span><br><span><span>var</span><span>&nbsp;</span><span>colorMap</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>color</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>//&nbsp;Put&nbsp;`&lt;string,&nbsp;color&gt;`&nbsp;pairs&nbsp;into&nbsp;`colorMap`&nbsp;on&nbsp;</span><span>the&nbsp;first&nbsp;bar.</span></span><br><span><span>if</span><span>&nbsp;</span><span>bar_index</span><span>&nbsp;</span><span>==</span><span>&nbsp;</span><span>0</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>colorMap</span><span>.</span><span>put</span><span>(</span><span>"Bull"</span><span>,</span><span>&nbsp;</span><span>color.green</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>colorMap</span><span>.</span><span>put</span><span>(</span><span>"Bear"</span><span>,</span><span>&nbsp;</span><span>color.red</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>colorMap</span><span>.</span><span>put</span><span>(</span><span>"Neutral"</span><span>,</span><span>&nbsp;</span><span>color.gray</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;14-bar&nbsp;RSI&nbsp;of&nbsp;`close`.</span></span><br><span><span>float</span><span>&nbsp;</span><span>oscillator</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>ta.rsi</span><span>(</span><span>close</span><span>,</span><span>&nbsp;</span><span>14</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;color&nbsp;of&nbsp;the&nbsp;`oscillator`.</span></span><br><span><span>color</span><span>&nbsp;</span><span>oscColor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>switch</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>oscillator</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>50</span><span>&nbsp;</span><span>=&gt;</span><span>&nbsp;</span><span>colorMap</span><span>.</span><span>get</span><span>(</span><span>"Bull"</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>oscillator</span><span>&nbsp;</span><span>&lt;</span><span>&nbsp;</span><span>50</span><span>&nbsp;</span><span>=&gt;</span><span>&nbsp;</span><span>colorMap</span><span>.</span><span>get</span><span>(</span><span>"Bear"</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>=&gt;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>colorMap</span><span>.</span><span>get</span><span>(</span><span>"Neutral"</span><span>)</span></span><br><span><span></span></span><br><span><span>//&nbsp;Plot&nbsp;the&nbsp;`oscillator`&nbsp;using&nbsp;the&nbsp;`oscColor`&nbsp;from</span><span>&nbsp;our&nbsp;`colorMap`.</span></span><br><span><span>plot</span><span>(</span><span>oscillator</span><span>,</span><span>&nbsp;</span><span>"Histogram"</span><span>,</span><span>&nbsp;</span><span>oscColor</span><span>,</span><span>&nbsp;</span><span>2</span><span>,</span><span>&nbsp;</span><span>plot.style_histogram</span><span>,</span><span>&nbsp;</span><span>histbase</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>50</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>oscillator</span><span>,</span><span>&nbsp;</span><span>"Line"</span><span>,</span><span>&nbsp;</span><span>oscColor</span><span>,</span><span>&nbsp;</span><span>3</span><span>)</span></span><br><span><span></span></span><br>
```

Note

Map variables declared using [varip](https://www.tradingview.com/pine-script-reference/v5/#kw_varip) behave as ones using [var](https://www.tradingview.com/pine-script-reference/v5/#kw_var) on historical data, but they update their key-value pairs for realtime bars (i.e., the bars since the script’s last compilation) on each new price tick. Maps assigned to [varip](https://www.tradingview.com/pine-script-reference/v5/#kw_varip) variables can only hold values of [int](https://www.tradingview.com/pine-script-reference/v5/#type_int), [float](https://www.tradingview.com/pine-script-reference/v5/#type_float), [bool](https://www.tradingview.com/pine-script-reference/v5/#type_bool), [color](https://www.tradingview.com/pine-script-reference/v5/#type_color), or [string](https://www.tradingview.com/pine-script-reference/v5/#type_string) types or [user-defined types](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-userdefinedtypes) that exclusively contain within their fields these types or collections ([arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#pagearrays), [matrices](https://www.tradingview.com/pine-script-docs/en/v5/language/Matrices.html#pagematrices), or maps) of these types.

## [Reading and writing](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id4)

### [Putting and getting key-value pairs](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id5)

The [map.put()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put) function is one that map users will utilize quite often, as it’s the primary method to put a new key-value pair into a map. It associates the `key` argument with the `value` argument in the call and adds the pair to the map `id`.

If the `key` argument in the [map.put()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put) call already exists in the map’s [keys](https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys), the new pair passed into the function will **replace** the existing one.

To retrieve the value from a map `id` associated with a given `key`, use [map.get()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.get). This function returns the value if the `id` map [contains](https://www.tradingview.com/pine-script-reference/v5/#fun_map.contains) the `key`. Otherwise, it returns [na](https://www.tradingview.com/pine-script-reference/v5/#var_na).

The following example calculates the difference between the [bar\_index](https://www.tradingview.com/pine-script-reference/v5/#var_bar_index) values from when [close](https://www.tradingview.com/pine-script-reference/v5/#var_close) was last [rising](https://www.tradingview.com/pine-script-reference/v5/#fun_ta.rising) and [falling](https://www.tradingview.com/pine-script-reference/v5/#fun_ta.falling) over a given `length` with the help of [map.put()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put) and [map.get()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.get) methods. The script puts a `("Rising", bar_index)` pair into the `data` map when the price is rising and puts a `("Falling", bar_index)` pair into the map when the price is falling. It then puts a pair containing the “Difference” between the “Rising” and “Falling” values into the map and plots its value on the chart:

![../_images/Maps-Reading-and-writing-Putting-and-getting-key-value-pairs-1.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Reading-and-writing-Putting-and-getting-key-value-pairs-1.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Putting&nbsp;and&nbsp;getting&nbsp;demo"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;`ta.rising()`&nbsp;and&nbsp;`ta.falling()</span><span>`&nbsp;calculation.</span></span><br><span><span>int</span><span>&nbsp;</span><span>length</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.int</span><span>(</span><span>2</span><span>,</span><span>&nbsp;</span><span>"Length"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;associating&nbsp;`string`&nbsp;keys&nbsp;with&nbsp;`int`&nbsp;values</span><span>.</span></span><br><span><span>var</span><span>&nbsp;</span><span>data</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>int</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>//&nbsp;Put&nbsp;a&nbsp;new&nbsp;("Rising",&nbsp;`bar_index`)&nbsp;pair&nbsp;into&nbsp;the</span><span>&nbsp;`data`&nbsp;map&nbsp;when&nbsp;`close`&nbsp;is&nbsp;rising.</span></span><br><span><span>if</span><span>&nbsp;</span><span>ta.rising</span><span>(</span><span>close</span><span>,</span><span>&nbsp;</span><span>length</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>data</span><span>.</span><span>put</span><span>(</span><span>"Rising"</span><span>,</span><span>&nbsp;</span><span>bar_index</span><span>)</span></span><br><span><span>//&nbsp;Put&nbsp;a&nbsp;new&nbsp;("Falling",&nbsp;`bar_index`)&nbsp;pair&nbsp;into&nbsp;th</span><span>e&nbsp;`data`&nbsp;map&nbsp;when&nbsp;`close`&nbsp;is&nbsp;falling.</span></span><br><span><span>if</span><span>&nbsp;</span><span>ta.falling</span><span>(</span><span>close</span><span>,</span><span>&nbsp;</span><span>length</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>data</span><span>.</span><span>put</span><span>(</span><span>"Falling"</span><span>,</span><span>&nbsp;</span><span>bar_index</span><span>)</span></span><br><span><span></span></span><br><span><span>//&nbsp;Put&nbsp;the&nbsp;"Difference"&nbsp;between&nbsp;current&nbsp;"Rising"&nbsp;a</span><span>nd&nbsp;"Falling"&nbsp;values&nbsp;into&nbsp;the&nbsp;`data`&nbsp;map.</span></span><br><span><span>data</span><span>.</span><span>put</span><span>(</span><span>"Difference"</span><span>,</span><span>&nbsp;</span><span>data</span><span>.</span><span>get</span><span>(</span><span>"Rising"</span><span>)</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>data</span><span>.</span><span>get</span><span>(</span><span>"Falling"</span><span>))</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;difference&nbsp;between&nbsp;the&nbsp;last&nbsp;"Rising"&nbsp;and&nbsp;"Fal</span><span>ling"&nbsp;`bar_index`.</span></span><br><span><span>int</span><span>&nbsp;</span><span>index</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>data</span><span>.</span><span>get</span><span>(</span><span>"Difference"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;Returns&nbsp;`color.green`&nbsp;when&nbsp;`index`&nbsp;is&nbsp;positive,&nbsp;`</span><span>color.red`&nbsp;when&nbsp;negative,&nbsp;and&nbsp;`color.gray`&nbsp;otherwi</span><span>se.</span></span><br><span><span>color</span><span>&nbsp;</span><span>indexColor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>index</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>0</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>color.green</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>index</span><span>&nbsp;</span><span>&lt;</span><span>&nbsp;</span><span>0</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>color.red</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>color.gray</span></span><br><span><span></span></span><br><span><span>plot</span><span>(</span><span>index</span><span>,</span><span>&nbsp;</span><span>color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>indexColor</span><span>,</span><span>&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>plot.style_columns</span><span>)</span></span><br><span><span></span></span><br>
```

Note that:

-   This script replaces the values associated with the “Rising”, “Falling”, and “Difference” keys on successive [data.put()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put) calls, as each of these keys is unique and can only appear once in the `data` map.
-   Replacing the pairs in a map does not change the internal _insertion order_ of its keys. We discuss this further in the [next section](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#pagemaps-readingandwriting-inspectingkeysandvalues).

Similar to working with other collections, when putting a value of a _special type_ ([line](https://www.tradingview.com/pine-script-reference/v5/#type_line), [linefill](https://www.tradingview.com/pine-script-reference/v5/#type_linefill), [box](https://www.tradingview.com/pine-script-reference/v5/#type_box), [polyline](https://www.tradingview.com/pine-script-reference/v5/#type_polyline), [label](https://www.tradingview.com/pine-script-reference/v5/#type_label), [table](https://www.tradingview.com/pine-script-reference/v5/#type_table), or [chart.point](https://www.tradingview.com/pine-script-reference/v5/#type_chart.point)) or a [user-defined type](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-userdefinedtypes) into a map, it’s important to note the inserted pair’s `value` points to that same object without copying it. Modifying the value referenced by a key-value pair will also affect the original object.

For example, this script contains a custom `ChartData` type with `o`, `h`, `l`, and `c` fields. On the first chart bar, the script declares a `myMap` variable and adds the pair `("A", myData)`, where `myData` is a `ChartData` instance with initial field values of `na`. It adds the pair `("B", myData)` to `myMap` and updates the object from this pair on every bar via the user-defined `update()` method.

Each change to the object with the “B” key affects the one referenced by the “A” key, as shown by the candle plot of the “A” object’s fields:

![../_images/Maps-Reading-and-writing-Putting-and-getting-key-value-pairs-2.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Reading-and-writing-Putting-and-getting-key-value-pairs-2.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Putting&nbsp;and&nbsp;getting&nbsp;objects&nbsp;demo"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@type</span><span>&nbsp;A&nbsp;custom&nbsp;type&nbsp;to&nbsp;hold&nbsp;OHLC&nbsp;data.</span></span><br><span><span>type</span><span>&nbsp;</span><span>ChartData</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>float</span><span>&nbsp;</span><span>o</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>float</span><span>&nbsp;</span><span>h</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>float</span><span>&nbsp;</span><span>l</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>float</span><span>&nbsp;</span><span>c</span></span><br><span><span></span></span><br><span><span>//</span><span>@function</span><span>&nbsp;Updates&nbsp;the&nbsp;fields&nbsp;of&nbsp;a&nbsp;`ChartData`&nbsp;object.</span></span><br><span><span>method</span><span>&nbsp;</span><span>update</span><span>(</span><span>ChartData</span><span>&nbsp;</span><span>this</span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>this</span><span>.</span><span>o</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>open</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>this</span><span>.</span><span>h</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>high</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>this</span><span>.</span><span>l</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>low</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>this</span><span>.</span><span>c</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>close</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;new&nbsp;`ChartData`&nbsp;instance&nbsp;declared&nbsp;on&nbsp;the&nbsp;first&nbsp;</span><span>bar.</span></span><br><span><span>var</span><span>&nbsp;</span><span>myData</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>ChartData</span><span>.</span><span>new</span><span>()</span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;associating&nbsp;`string`&nbsp;keys&nbsp;with&nbsp;`ChartData`&nbsp;</span><span>instances.</span></span><br><span><span>var</span><span>&nbsp;</span><span>myMap</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>ChartData</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>//&nbsp;Put&nbsp;a&nbsp;new&nbsp;pair&nbsp;with&nbsp;the&nbsp;"A"&nbsp;key&nbsp;into&nbsp;`myMap`&nbsp;on</span><span>ly&nbsp;on&nbsp;the&nbsp;first&nbsp;bar.</span></span><br><span><span>if</span><span>&nbsp;</span><span>bar_index</span><span>&nbsp;</span><span>==</span><span>&nbsp;</span><span>0</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>myMap</span><span>.</span><span>put</span><span>(</span><span>"A"</span><span>,</span><span>&nbsp;</span><span>myData</span><span>)</span></span><br><span><span></span></span><br><span><span>//&nbsp;Put&nbsp;a&nbsp;pair&nbsp;with&nbsp;the&nbsp;"B"&nbsp;key&nbsp;into&nbsp;`myMap`&nbsp;on&nbsp;eve</span><span>ry&nbsp;bar.</span></span><br><span><span>myMap</span><span>.</span><span>put</span><span>(</span><span>"B"</span><span>,</span><span>&nbsp;</span><span>myData</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;`ChartData`&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;"A"&nbsp;key</span><span>&nbsp;in&nbsp;`myMap`.</span></span><br><span><span>ChartData</span><span>&nbsp;</span><span>oldest</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>myMap</span><span>.</span><span>get</span><span>(</span><span>"A"</span><span>)</span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;`ChartData`&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;"B"&nbsp;key</span><span>&nbsp;in&nbsp;`myMap`.</span></span><br><span><span>ChartData</span><span>&nbsp;</span><span>newest</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>myMap</span><span>.</span><span>get</span><span>(</span><span>"B"</span><span>)</span></span><br><span><span></span></span><br><span><span>//&nbsp;Update&nbsp;`newest`.&nbsp;Also&nbsp;affects&nbsp;`oldest`&nbsp;and&nbsp;`myD</span><span>ata`&nbsp;since&nbsp;they&nbsp;all&nbsp;reference&nbsp;the&nbsp;same&nbsp;`ChartData`</span><span>&nbsp;object.</span></span><br><span><span>newest</span><span>.</span><span>update</span><span>()</span></span><br><span><span></span></span><br><span><span>//&nbsp;Plot&nbsp;the&nbsp;fields&nbsp;of&nbsp;`oldest`&nbsp;as&nbsp;candles.</span></span><br><span><span>plotcandle</span><span>(</span><span>oldest</span><span>.</span><span>o</span><span>,</span><span>&nbsp;</span><span>oldest</span><span>.</span><span>h</span><span>,</span><span>&nbsp;</span><span>oldest</span><span>.</span><span>l</span><span>,</span><span>&nbsp;</span><span>oldest</span><span>.</span><span>c</span><span>)</span></span><br><span><span></span></span><br>
```

Note that:

-   This script would behave differently if it passed a copy of `myData` into each [myMap.put()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put) call. For more information, see [this](https://www.tradingview.com/pine-script-docs/en/v5/language/Objects.html#pageobjects-copyingobjects) section of our User Manual’s page on [objects](https://www.tradingview.com/pine-script-docs/en/v5/language/Objects.html#pageobjects).

### [Inspecting keys and values](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id6)

#### [\`map.keys()\` and \`map.values()\`](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id7)

To retrieve all keys and values put into a map, use [map.keys()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys) and [map.values()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.values). These functions copy all key/value references within a map `id` to a new [array](https://www.tradingview.com/pine-script-reference/v5/#type_array) object. Modifying the array returned from either of these functions does not affect the `id` map.

Although maps are _unordered_ collections, Pine Script™ internally maintains the _insertion order_ of a map’s key-value pairs. As a result, the [map.keys()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys) and [map.values()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.values) functions always return [arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#pagearrays) with their elements ordered based on the `id` map’s insertion order.

The script below demonstrates this by displaying the key and value arrays from an `m` map in a [label](https://www.tradingview.com/pine-script-reference/v5/#type_label) once every 50 bars. As we see on the chart, the order of elements in each array returned by `m.keys()` and `m.values()` aligns with the insertion order of the key-value pairs in `m`:

![../_images/Maps-Reading-and-writing-Inspecting-keys-and-values-1.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Reading-and-writing-Inspecting-keys-and-values-1.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Keys&nbsp;and&nbsp;values&nbsp;demo"</span><span>)</span></span><br><span><span></span></span><br><span><span>if</span><span>&nbsp;</span><span>bar_index</span><span>&nbsp;</span><span>%</span><span>&nbsp;</span><span>50</span><span>&nbsp;</span><span>==</span><span>&nbsp;</span><span>0</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;containing&nbsp;pairs&nbsp;of&nbsp;`string`&nbsp;keys&nbsp;and&nbsp;`floa</span><span>t`&nbsp;values.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Put&nbsp;pairs&nbsp;into&nbsp;`m`.&nbsp;The&nbsp;map&nbsp;will&nbsp;maintain&nbsp;this&nbsp;</span><span>insertion&nbsp;order.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>put</span><span>(</span><span>"First"</span><span>,</span><span>&nbsp;</span><span>math.round</span><span>(</span><span>math.random</span><span>(</span><span>0</span><span>,</span><span>&nbsp;</span><span>100</span><span>)))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>put</span><span>(</span><span>"Second"</span><span>,</span><span>&nbsp;</span><span>m</span><span>.</span><span>get</span><span>(</span><span>"First"</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>put</span><span>(</span><span>"Third"</span><span>,</span><span>&nbsp;</span><span>m</span><span>.</span><span>get</span><span>(</span><span>"Second"</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;An&nbsp;array&nbsp;containing&nbsp;the&nbsp;keys&nbsp;of&nbsp;`m`&nbsp;in&nbsp;their&nbsp;inse</span><span>rtion&nbsp;order.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array</span><span>&lt;</span><span>string</span><span>&gt;</span><span>&nbsp;</span><span>keys</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>m</span><span>.</span><span>keys</span><span>()</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;An&nbsp;array&nbsp;containing&nbsp;the&nbsp;values&nbsp;of&nbsp;`m`&nbsp;in&nbsp;their&nbsp;in</span><span>sertion&nbsp;order.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array</span><span>&lt;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>values</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>m</span><span>.</span><span>values</span><span>()</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;label&nbsp;displaying&nbsp;the&nbsp;`size`&nbsp;of&nbsp;`m`&nbsp;and&nbsp;the&nbsp;`key</span><span>s`&nbsp;and&nbsp;`values`&nbsp;arrays.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label</span><span>&nbsp;</span><span>debugLabel</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.new</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>str.format</span><span>(</span><span>"Pairs:&nbsp;{0}\nKeys:&nbsp;{1}\nValues:&nbsp;{2}"</span><span>,</span><span>&nbsp;</span><span>m</span><span>.</span><span>size</span><span>()</span><span>,</span><span>&nbsp;</span><span>keys</span><span>,</span><span>&nbsp;</span><span>values</span><span>)</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.navy</span><span>,</span><span>&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.style_label_center</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>textcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.huge</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span></span></span><br>
```

Note that:

-   The value with the “First” key is a [random](https://www.tradingview.com/pine-script-reference/v5/#fun_math.random) whole number between 0 and 100. The “Second” value is one greater than the “First”, and the “Third” value is one greater than the “Second”.

It’s important to note a map’s internal insertion order **does not** change when replacing its key-value pairs. The locations of the new elements in the [keys()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys) and [values()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.values) arrays will be the same as the old elements in such cases. The only exception is if the script completely [removes](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#pagemaps-readingandwriting-removingkeyvaluepairs) the key beforehand.

Below, we’ve added a line of code to [put](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put) a new value with the “Second” key into the `m` map, overwriting the previous value associated with that key. Although the script puts this new pair into the map _after_ the one with the “Third” key, the pair’s key and value are still second in the `keys` and `values` arrays since the key was already present in `m` _before_ the change:

![../_images/Maps-Reading-and-writing-Inspecting-keys-and-values-2.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Reading-and-writing-Inspecting-keys-and-values-2.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Keys&nbsp;and&nbsp;values&nbsp;demo"</span><span>)</span></span><br><span><span></span></span><br><span><span>if</span><span>&nbsp;</span><span>bar_index</span><span>&nbsp;</span><span>%</span><span>&nbsp;</span><span>50</span><span>&nbsp;</span><span>==</span><span>&nbsp;</span><span>0</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;containing&nbsp;pairs&nbsp;of&nbsp;`string`&nbsp;keys&nbsp;and&nbsp;`floa</span><span>t`&nbsp;values.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Put&nbsp;pairs&nbsp;into&nbsp;`m`.&nbsp;The&nbsp;map&nbsp;will&nbsp;maintain&nbsp;this&nbsp;</span><span>insertion&nbsp;order.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>put</span><span>(</span><span>"First"</span><span>,</span><span>&nbsp;</span><span>math.round</span><span>(</span><span>math.random</span><span>(</span><span>0</span><span>,</span><span>&nbsp;</span><span>100</span><span>)))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>put</span><span>(</span><span>"Second"</span><span>,</span><span>&nbsp;</span><span>m</span><span>.</span><span>get</span><span>(</span><span>"First"</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>put</span><span>(</span><span>"Third"</span><span>,</span><span>&nbsp;</span><span>m</span><span>.</span><span>get</span><span>(</span><span>"Second"</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Overwrite&nbsp;the&nbsp;"Second"&nbsp;pair&nbsp;in&nbsp;`m`.&nbsp;This&nbsp;will&nbsp;N</span><span>OT&nbsp;affect&nbsp;the&nbsp;insertion&nbsp;order.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;The&nbsp;key&nbsp;and&nbsp;value&nbsp;will&nbsp;still&nbsp;appear&nbsp;second&nbsp;in&nbsp;t</span><span>he&nbsp;`keys`&nbsp;and&nbsp;`values`&nbsp;arrays.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>put</span><span>(</span><span>"Second"</span><span>,</span><span>&nbsp;</span><span>-2</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;An&nbsp;array&nbsp;containing&nbsp;the&nbsp;keys&nbsp;of&nbsp;`m`&nbsp;in&nbsp;their&nbsp;inse</span><span>rtion&nbsp;order.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array</span><span>&lt;</span><span>string</span><span>&gt;</span><span>&nbsp;</span><span>keys</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>m</span><span>.</span><span>keys</span><span>()</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;An&nbsp;array&nbsp;containing&nbsp;the&nbsp;values&nbsp;of&nbsp;`m`&nbsp;in&nbsp;their&nbsp;in</span><span>sertion&nbsp;order.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array</span><span>&lt;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>values</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>m</span><span>.</span><span>values</span><span>()</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;label&nbsp;displaying&nbsp;the&nbsp;`size`&nbsp;of&nbsp;`m`&nbsp;and&nbsp;the&nbsp;`key</span><span>s`&nbsp;and&nbsp;`values`&nbsp;arrays.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label</span><span>&nbsp;</span><span>debugLabel</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.new</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>str.format</span><span>(</span><span>"Pairs:&nbsp;{0}\nKeys:&nbsp;{1}\nValues:&nbsp;{2}"</span><span>,</span><span>&nbsp;</span><span>m</span><span>.</span><span>size</span><span>()</span><span>,</span><span>&nbsp;</span><span>keys</span><span>,</span><span>&nbsp;</span><span>values</span><span>)</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.navy</span><span>,</span><span>&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.style_label_center</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>textcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.huge</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span></span></span><br>
```

Note

The elements in a [map.values()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.values) array point to the same values as the map `id`. Consequently, when the map’s values are of _reference types_, including [line](https://www.tradingview.com/pine-script-reference/v5/#type_line), [linefill](https://www.tradingview.com/pine-script-reference/v5/#type_linefill), [box](https://www.tradingview.com/pine-script-reference/v5/#type_box), [polyline](https://www.tradingview.com/pine-script-reference/v5/#type_polyline), [label](https://www.tradingview.com/pine-script-reference/v5/#type_label), [table](https://www.tradingview.com/pine-script-reference/v5/#type_table), [chart.point](https://www.tradingview.com/pine-script-reference/v5/#type_chart.point), or [UDTs](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-userdefinedtypes), modifying the instances referenced by the [map.values()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.values) array will also affect those referenced by the map `id` since the contents of both collections point to identical objects.

#### [\`map.contains()\`](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id8)

To check if a specific `key` exists within a map `id`, use [map.contains()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.contains). This function is a convenient alternative to calling [array.includes()](https://www.tradingview.com/pine-script-reference/v5/#fun_array.includes) on the [array](https://www.tradingview.com/pine-script-reference/v5/#type_array) returned from [map.keys()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys).

For example, this script checks if various keys exist within an `m` map, then displays the results in a [label](https://www.tradingview.com/pine-script-reference/v5/#type_label):

![../_images/Maps-Reading-and-writing-Inspecting-keys-and-values-3.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Reading-and-writing-Inspecting-keys-and-values-3.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Inspecting&nbsp;keys&nbsp;demo"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;containing&nbsp;`string`&nbsp;keys&nbsp;and&nbsp;`string`&nbsp;value</span><span>s.</span></span><br><span><span>m</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>string</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>//&nbsp;Put&nbsp;key-value&nbsp;pairs&nbsp;into&nbsp;the&nbsp;map.</span></span><br><span><span>m</span><span>.</span><span>put</span><span>(</span><span>"A"</span><span>,</span><span>&nbsp;</span><span>"B"</span><span>)</span></span><br><span><span>m</span><span>.</span><span>put</span><span>(</span><span>"C"</span><span>,</span><span>&nbsp;</span><span>"D"</span><span>)</span></span><br><span><span>m</span><span>.</span><span>put</span><span>(</span><span>"E"</span><span>,</span><span>&nbsp;</span><span>"F"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;An&nbsp;array&nbsp;of&nbsp;keys&nbsp;to&nbsp;check&nbsp;for&nbsp;in&nbsp;`m`.</span></span><br><span><span>array</span><span>&lt;</span><span>string</span><span>&gt;</span><span>&nbsp;</span><span>testKeys</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.from</span><span>(</span><span>"A"</span><span>,</span><span>&nbsp;</span><span>"B"</span><span>,</span><span>&nbsp;</span><span>"C"</span><span>,</span><span>&nbsp;</span><span>"D"</span><span>,</span><span>&nbsp;</span><span>"E"</span><span>,</span><span>&nbsp;</span><span>"F"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;An&nbsp;array&nbsp;containing&nbsp;all&nbsp;elements&nbsp;from&nbsp;`testKeys`&nbsp;</span><span>found&nbsp;in&nbsp;the&nbsp;keys&nbsp;of&nbsp;`m`.</span></span><br><span><span>array</span><span>&lt;</span><span>string</span><span>&gt;</span><span>&nbsp;</span><span>mappedKeys</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>string</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>for</span><span>&nbsp;</span><span>key</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>testKeys</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Add&nbsp;the&nbsp;`key`&nbsp;to&nbsp;`mappedKeys`&nbsp;if&nbsp;`m`&nbsp;contains&nbsp;i</span><span>t.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>if</span><span>&nbsp;</span><span>m</span><span>.</span><span>contains</span><span>(</span><span>key</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mappedKeys</span><span>.</span><span>push</span><span>(</span><span>key</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;string&nbsp;representing&nbsp;the&nbsp;`testKeys`&nbsp;array&nbsp;and&nbsp;th</span><span>e&nbsp;elements&nbsp;found&nbsp;within&nbsp;the&nbsp;keys&nbsp;of&nbsp;`m`.</span></span><br><span><span>string</span><span>&nbsp;</span><span>testText</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>str.format</span><span>(</span><span>"Tested&nbsp;keys:&nbsp;{0}\nKeys&nbsp;found:&nbsp;{1}"</span><span>,</span><span>&nbsp;</span><span>testKeys</span><span>,</span><span>&nbsp;</span><span>mappedKeys</span><span>)</span></span><br><span><span></span></span><br><span><span>if</span><span>&nbsp;</span><span>bar_index</span><span>&nbsp;</span><span>==</span><span>&nbsp;</span><span>last_bar_index</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>1</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;Displays&nbsp;the&nbsp;`testText`&nbsp;in&nbsp;a&nbsp;label&nbsp;at&nbsp;the&nbsp;`bar_in</span><span>dex`&nbsp;before&nbsp;the&nbsp;last.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label</span><span>&nbsp;</span><span>debugLabel</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.new</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>testText</span><span>,</span><span>&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.style_label_center</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>textcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.huge</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span></span></span><br>
```

### [Removing key-value pairs](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id9)

To remove a specific key-value pair from a map `id`, use [map.remove()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.remove). This function removes the `key` and its associated value from the map while preserving the insertion order of other key-value pairs. It returns the removed value if the map [contained](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#pagemaps-readingandwriting-inspectingkeysandvalues-mapcontains) the `key`. Otherwise, it returns [na](https://www.tradingview.com/pine-script-reference/v5/#var_na).

To remove all key-value pairs from a map `id` at once, use [map.clear()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.clear).

The following script creates a new `m` map, [puts](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#pagemaps-readingandwriting-puttingandgettingkeyvaluepairs) key-value pairs into the map, uses [m.remove()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.remove) within a loop to remove each valid `key` listed in the `removeKeys` array, then calls [m.clear()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.clear) to remove all remaining key-value pairs. It uses a custom `debugLabel()` method to display the [size](https://www.tradingview.com/pine-script-reference/v5/#fun_map.size), [keys](https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys), and [values](https://www.tradingview.com/pine-script-reference/v5/#fun_map.values) of `m` after each change:

![../_images/Maps-Reading-and-writing-Removing-key-value-pairs-1.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Reading-and-writing-Removing-key-value-pairs-1.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Removing&nbsp;key-value&nbsp;pairs&nbsp;demo"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@function</span><span>&nbsp;Returns&nbsp;a&nbsp;label&nbsp;to&nbsp;display&nbsp;the&nbsp;keys&nbsp;and&nbsp;values&nbsp;fr</span><span>om&nbsp;a&nbsp;map.</span></span><br><span><span>method</span><span>&nbsp;</span><span>debugLabel</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>int</span><span>&gt;</span><span>&nbsp;</span><span>this</span><span>,</span><span>&nbsp;</span><span>int</span><span>&nbsp;</span><span>barIndex</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>bar_index</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>color</span><span>&nbsp;</span><span>bgColor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.blue</span><span>,</span><span>&nbsp;</span><span>string</span><span>&nbsp;</span><span>note</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>""</span></span><br><span><span>&nbsp;</span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;string&nbsp;representing&nbsp;the&nbsp;size,&nbsp;keys,&nbsp;and&nbsp;values&nbsp;</span><span>in&nbsp;`this`&nbsp;map.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;</span><span>repr</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>str.format</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>"{0}\nSize:&nbsp;{1}\nKeys:&nbsp;{2}\nValues:&nbsp;{3}"</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>note</span><span>,</span><span>&nbsp;</span><span>this</span><span>.</span><span>size</span><span>()</span><span>,</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>this</span><span>.</span><span>keys</span><span>())</span><span>,</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>this</span><span>.</span><span>values</span><span>())</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>barIndex</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>repr</span><span>,</span><span>&nbsp;</span><span>color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>bgColor</span><span>,</span><span>&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.style_label_center</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>textcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.huge</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span></span></span><br><span><span>if</span><span>&nbsp;</span><span>bar_index</span><span>&nbsp;</span><span>==</span><span>&nbsp;</span><span>last_bar_index</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>1</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;containing&nbsp;`string`&nbsp;keys&nbsp;and&nbsp;`int`&nbsp;values.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>int</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Put&nbsp;key-value&nbsp;pairs&nbsp;into&nbsp;`m`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>[</span><span>i</span><span>,</span><span>&nbsp;</span><span>key</span><span>]</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>array.from</span><span>(</span><span>"A"</span><span>,</span><span>&nbsp;</span><span>"B"</span><span>,</span><span>&nbsp;</span><span>"C"</span><span>,</span><span>&nbsp;</span><span>"D"</span><span>,</span><span>&nbsp;</span><span>"E"</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>put</span><span>(</span><span>key</span><span>,</span><span>&nbsp;</span><span>i</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>debugLabel</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>color.green</span><span>,</span><span>&nbsp;</span><span>"Added&nbsp;pairs"</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;An&nbsp;array&nbsp;of&nbsp;keys&nbsp;to&nbsp;remove&nbsp;from&nbsp;`m`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array</span><span>&lt;</span><span>string</span><span>&gt;</span><span>&nbsp;</span><span>removeKeys</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.from</span><span>(</span><span>"B"</span><span>,</span><span>&nbsp;</span><span>"B"</span><span>,</span><span>&nbsp;</span><span>"D"</span><span>,</span><span>&nbsp;</span><span>"F"</span><span>,</span><span>&nbsp;</span><span>"a"</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Remove&nbsp;each&nbsp;`key`&nbsp;in&nbsp;`removeKeys`&nbsp;from&nbsp;`m`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>key</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>removeKeys</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>remove</span><span>(</span><span>key</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>debugLabel</span><span>(</span><span>bar_index</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>10</span><span>,</span><span>&nbsp;</span><span>color.red</span><span>,</span><span>&nbsp;</span><span>"Removed&nbsp;pairs"</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Remove&nbsp;all&nbsp;remaining&nbsp;keys&nbsp;from&nbsp;`m`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>clear</span><span>()</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>debugLabel</span><span>(</span><span>bar_index</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>20</span><span>,</span><span>&nbsp;</span><span>color.purple</span><span>,</span><span>&nbsp;</span><span>"Cleared&nbsp;the&nbsp;map"</span><span>)</span></span><br><span><span></span></span><br>
```

Note that:

-   Not all strings in the `removeKeys` array were present in the keys of `m`. Attempting to remove non-existent keys (“F”, “a”, and the second “B” in this example) has no effect on a map’s contents.

### [Combining maps](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id10)

Scripts can combine two maps via [map.put\_all()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put_all). This function puts _all_ key-value pairs from the `id2` map, in their insertion order, into the `id1` map. As with [map.put()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put), if any keys in `id2` are also present in `id1`, this function **replaces** the key-value pairs that contain those keys without affecting their initial insertion order.

This example contains a user-defined `hexMap()` function that maps decimal [int](https://www.tradingview.com/pine-script-reference/v5/#type_int) keys to [string](https://www.tradingview.com/pine-script-reference/v5/#type_string) representations of their [hexadecimal](https://en.wikipedia.org//wiki/Hexadecimal) forms. The script uses this function to create two maps, `mapA` and `mapB`, then uses [mapA.put\_all(mapB)](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put_all) to put all key-value pairs from `mapB` into `mapA`.

The script uses a custom `debugLabel()` function to display labels showing the [keys](https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys) and [values](https://www.tradingview.com/pine-script-reference/v5/#fun_map.values) of `mapA` and `mapB`, then another label displaying the contents of `mapA` after putting all key-value pairs from `mapB` into it:

![../_images/Maps-Reading-and-writing-Combining-maps-1.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Reading-and-writing-Combining-maps-1.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Combining&nbsp;maps&nbsp;demo"</span><span>,</span><span>&nbsp;</span><span>"Hex&nbsp;map"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;An&nbsp;array&nbsp;of&nbsp;string&nbsp;hex&nbsp;digits.</span></span><br><span><span>var</span><span>&nbsp;</span><span>array</span><span>&lt;</span><span>string</span><span>&gt;</span><span>&nbsp;</span><span>hexDigits</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>str.split</span><span>(</span><span>"0123456789ABCDEF"</span><span>,</span><span>&nbsp;</span><span>""</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@function</span><span>&nbsp;Returns&nbsp;a&nbsp;hexadecimal&nbsp;string&nbsp;for&nbsp;the&nbsp;specified&nbsp;`v</span><span>alue`.</span></span><br><span><span>hex</span><span>(</span><span>int</span><span>&nbsp;</span><span>value</span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;string&nbsp;representing&nbsp;the&nbsp;hex&nbsp;form&nbsp;of&nbsp;the&nbsp;`value`</span><span>.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;</span><span>result</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>""</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;temporary&nbsp;value&nbsp;for&nbsp;digit&nbsp;calculation.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;</span><span>tempValue</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>value</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>while</span><span>&nbsp;</span><span>tempValue</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>0</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;next&nbsp;integer&nbsp;digit.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;</span><span>digit</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>tempValue</span><span>&nbsp;</span><span>%</span><span>&nbsp;</span><span>16</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Add&nbsp;the&nbsp;hex&nbsp;form&nbsp;of&nbsp;the&nbsp;`digit`&nbsp;to&nbsp;the&nbsp;`result`</span><span>.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>hexDigits</span><span>.</span><span>get</span><span>(</span><span>digit</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>result</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Divide&nbsp;the&nbsp;`tempValue`&nbsp;by&nbsp;the&nbsp;base.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>tempValue</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>int</span><span>(</span><span>tempValue</span><span>&nbsp;</span><span>/</span><span>&nbsp;</span><span>16</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span></span><br><span><span></span></span><br><span><span>//</span><span>@function</span><span>&nbsp;Returns&nbsp;a&nbsp;map&nbsp;holding&nbsp;the&nbsp;`numbers`&nbsp;as&nbsp;keys&nbsp;and&nbsp;t</span><span>heir&nbsp;`hex`&nbsp;strings&nbsp;as&nbsp;values.</span></span><br><span><span>hexMap</span><span>(</span><span>array</span><span>&lt;</span><span>int</span><span>&gt;</span><span>&nbsp;</span><span>numbers</span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;associating&nbsp;`int`&nbsp;keys&nbsp;with&nbsp;`string`&nbsp;values</span><span>.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>int</span><span>,</span><span>&nbsp;</span><span>string</span><span>&gt;()</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>number</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>numbers</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Put&nbsp;a&nbsp;pair&nbsp;containing&nbsp;the&nbsp;`number`&nbsp;and&nbsp;its&nbsp;`hex</span><span>()`&nbsp;representation&nbsp;into&nbsp;the&nbsp;`result`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>put</span><span>(</span><span>number</span><span>,</span><span>&nbsp;</span><span>hex</span><span>(</span><span>number</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span></span><br><span><span></span></span><br><span><span>//</span><span>@function</span><span>&nbsp;Returns&nbsp;a&nbsp;label&nbsp;to&nbsp;display&nbsp;the&nbsp;keys&nbsp;and&nbsp;values&nbsp;of</span><span>&nbsp;a&nbsp;hex&nbsp;map.</span></span><br><span><span>debugLabel</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map</span><span>&lt;</span><span>int</span><span>,</span><span>&nbsp;</span><span>string</span><span>&gt;</span><span>&nbsp;</span><span>this</span><span>,</span><span>&nbsp;</span><span>int</span><span>&nbsp;</span><span>barIndex</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>color</span><span>&nbsp;</span><span>bgColor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.blue</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.style_label_center</span><span>,</span><span>&nbsp;</span><span>string</span><span>&nbsp;</span><span>note</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>""</span></span><br><span><span>&nbsp;</span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;</span><span>repr</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>str.format</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>"{0}\nDecimal:&nbsp;{1}\nHex:&nbsp;{2}"</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>note</span><span>,</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>this</span><span>.</span><span>keys</span><span>())</span><span>,</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>this</span><span>.</span><span>values</span><span>())</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>barIndex</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>repr</span><span>,</span><span>&nbsp;</span><span>color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>bgColor</span><span>,</span><span>&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>style</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>textcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.huge</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span></span></span><br><span><span>if</span><span>&nbsp;</span><span>bar_index</span><span>&nbsp;</span><span>==</span><span>&nbsp;</span><span>last_bar_index</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>1</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;with&nbsp;decimal&nbsp;`int`&nbsp;keys&nbsp;and&nbsp;hexadecimal&nbsp;`st</span><span>ring`&nbsp;values.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map</span><span>&lt;</span><span>int</span><span>,</span><span>&nbsp;</span><span>string</span><span>&gt;</span><span>&nbsp;</span><span>mapA</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>hexMap</span><span>(</span><span>array.from</span><span>(</span><span>101</span><span>,</span><span>&nbsp;</span><span>202</span><span>,</span><span>&nbsp;</span><span>303</span><span>,</span><span>&nbsp;</span><span>404</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>debugLabel</span><span>(</span><span>mapA</span><span>,</span><span>&nbsp;</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>color.navy</span><span>,</span><span>&nbsp;</span><span>label.style_label_down</span><span>,</span><span>&nbsp;</span><span>"A"</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;containing&nbsp;key-value&nbsp;pairs&nbsp;to&nbsp;add&nbsp;to&nbsp;`mapA`</span><span>.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map</span><span>&lt;</span><span>int</span><span>,</span><span>&nbsp;</span><span>string</span><span>&gt;</span><span>&nbsp;</span><span>mapB</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>hexMap</span><span>(</span><span>array.from</span><span>(</span><span>303</span><span>,</span><span>&nbsp;</span><span>404</span><span>,</span><span>&nbsp;</span><span>505</span><span>,</span><span>&nbsp;</span><span>606</span><span>,</span><span>&nbsp;</span><span>707</span><span>,</span><span>&nbsp;</span><span>808</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>debugLabel</span><span>(</span><span>mapB</span><span>,</span><span>&nbsp;</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>color.maroon</span><span>,</span><span>&nbsp;</span><span>label.style_label_up</span><span>,</span><span>&nbsp;</span><span>"B"</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Put&nbsp;all&nbsp;pairs&nbsp;from&nbsp;`mapB`&nbsp;into&nbsp;`mapA`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mapA</span><span>.</span><span>put_all</span><span>(</span><span>mapB</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>debugLabel</span><span>(</span><span>mapA</span><span>,</span><span>&nbsp;</span><span>bar_index</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>10</span><span>,</span><span>&nbsp;</span><span>color.purple</span><span>,</span><span>&nbsp;</span><span>note</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>"Merge&nbsp;B&nbsp;into&nbsp;A"</span><span>)</span></span><br><span><span></span></span><br>
```

## [Looping through a map](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id11)

There are several ways scripts can iteratively access the keys and values in a map. For example, one could loop through a map’s [keys()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.keys) array and [get()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.get) the value for each `key`, like so:

```
<span><span>for</span><span>&nbsp;</span><span>key</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>thisMap</span><span>.</span><span>keys</span><span>()</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>value</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>thisMap</span><span>.</span><span>get</span><span>(</span><span>key</span><span>)</span></span><br><span><span></span></span><br>
```

However, we recommend using a `for...in` loop directly on a map, as it iterates over the map’s key-value pairs in their insertion order, returning a tuple containing the next pair’s key and value on each iteration.

For example, this line of code loops through each `key` and `value` in `thisMap`, starting from the first key-value pair put into it:

```
<span><span>for</span><span>&nbsp;</span><span>[</span><span>key</span><span>,</span><span>&nbsp;</span><span>value</span><span>]</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>thisMap</span></span><br><span><span></span></span><br>
```

Let’s use this structure to write a script that displays a map’s key-value pairs in a [table](https://www.tradingview.com/pine-script-reference/v5/#type_table). In the example below, we’ve defined a custom `toTable()` method that creates a [table](https://www.tradingview.com/pine-script-reference/v5/#type_table), then uses a `for...in` loop to iterate over the map’s key-value pairs and populate the table’s cells. The script uses this method to visualize a map containing `length`\-bar `averages` of price and volume data:

![../_images/Maps-Looping-through-a-map-1.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Looping-through-a-map-1.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Looping&nbsp;through&nbsp;a&nbsp;map&nbsp;demo"</span><span>,</span><span>&nbsp;</span><span>"Table&nbsp;of&nbsp;averages"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;length&nbsp;of&nbsp;the&nbsp;moving&nbsp;average.</span></span><br><span><span>int</span><span>&nbsp;</span><span>length</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.int</span><span>(</span><span>20</span><span>,</span><span>&nbsp;</span><span>"Length"</span><span>)</span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;size&nbsp;of&nbsp;the&nbsp;table&nbsp;text.</span></span><br><span><span>string</span><span>&nbsp;</span><span>txtSize</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.string</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>size.huge</span><span>,</span><span>&nbsp;</span><span>"Text&nbsp;size"</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>options</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>[</span><span>size.auto</span><span>,</span><span>&nbsp;</span><span>size.tiny</span><span>,</span><span>&nbsp;</span><span>size.small</span><span>,</span><span>&nbsp;</span><span>size.normal</span><span>,</span><span>&nbsp;</span><span>size.large</span><span>,</span><span>&nbsp;</span><span>size.huge</span><span>]</span></span><br><span><span>&nbsp;</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@function</span><span>&nbsp;Displays&nbsp;the&nbsp;pairs&nbsp;of&nbsp;`this`&nbsp;map&nbsp;within&nbsp;a&nbsp;table.</span></span><br><span><span>//</span><span>@param</span><span>&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;A&nbsp;map&nbsp;with&nbsp;`string`&nbsp;keys&nbsp;and&nbsp;`float`&nbsp;valu</span><span>es.</span></span><br><span><span>//</span><span>@param</span><span>&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;The&nbsp;position&nbsp;of&nbsp;the&nbsp;table&nbsp;on&nbsp;the&nbsp;char</span><span>t.</span></span><br><span><span>//</span><span>@param</span><span>&nbsp;&nbsp;&nbsp;&nbsp;header&nbsp;The&nbsp;string&nbsp;to&nbsp;display&nbsp;on&nbsp;the&nbsp;top&nbsp;row&nbsp;of</span><span>&nbsp;the&nbsp;table.</span></span><br><span><span>//</span><span>@param</span><span>&nbsp;&nbsp;&nbsp;&nbsp;textSize&nbsp;The&nbsp;size&nbsp;of&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;table.</span></span><br><span><span>//</span><span>@returns</span><span>&nbsp;&nbsp;A&nbsp;new&nbsp;`table`&nbsp;object&nbsp;with&nbsp;cells&nbsp;displaying&nbsp;each&nbsp;</span><span>pair&nbsp;in&nbsp;`this`.</span></span><br><span><span>method</span><span>&nbsp;</span><span>toTable</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>this</span><span>,</span><span>&nbsp;</span><span>string</span><span>&nbsp;</span><span>position</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>position.middle_center</span><span>,</span><span>&nbsp;</span><span>string</span><span>&nbsp;</span><span>header</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>na</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;</span><span>textSize</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.huge</span></span><br><span><span>&nbsp;</span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Color&nbsp;variables</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>borderColor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>#000000</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>headerColor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.rgb</span><span>(</span><span>1</span><span>,</span><span>&nbsp;</span><span>88</span><span>,</span><span>&nbsp;</span><span>80</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>pairColor</span><span>&nbsp;&nbsp;&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.maroon</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>textColor</span><span>&nbsp;&nbsp;&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;table&nbsp;that&nbsp;displays&nbsp;the&nbsp;key-value&nbsp;pairs&nbsp;of&nbsp;`thi</span><span>s`&nbsp;map.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>table</span><span>&nbsp;</span><span>result</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>table.new</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>position</span><span>,</span><span>&nbsp;</span><span>this</span><span>.</span><span>size</span><span>()</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>1</span><span>,</span><span>&nbsp;</span><span>3</span><span>,</span><span>&nbsp;</span><span>border_width</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>2</span><span>,</span><span>&nbsp;</span><span>border_color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>borderColor</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Initialize&nbsp;top&nbsp;and&nbsp;side&nbsp;header&nbsp;cells.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>cell</span><span>(</span><span>1</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>header</span><span>,</span><span>&nbsp;</span><span>bgcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>headerColor</span><span>,</span><span>&nbsp;</span><span>text_color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>textColor</span><span>,</span><span>&nbsp;</span><span>text_size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>textSize</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>merge_cells</span><span>(</span><span>1</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>this</span><span>.</span><span>size</span><span>()</span><span>,</span><span>&nbsp;</span><span>0</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>cell</span><span>(</span><span>0</span><span>,</span><span>&nbsp;</span><span>1</span><span>,</span><span>&nbsp;</span><span>"Key"</span><span>,</span><span>&nbsp;</span><span>bgcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>headerColor</span><span>,</span><span>&nbsp;</span><span>text_color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>textColor</span><span>,</span><span>&nbsp;</span><span>text_size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>textSize</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>cell</span><span>(</span><span>0</span><span>,</span><span>&nbsp;</span><span>2</span><span>,</span><span>&nbsp;</span><span>"Value"</span><span>,</span><span>&nbsp;</span><span>bgcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>headerColor</span><span>,</span><span>&nbsp;</span><span>text_color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>textColor</span><span>,</span><span>&nbsp;</span><span>text_size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>textSize</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;column&nbsp;index&nbsp;of&nbsp;the&nbsp;table.&nbsp;Updates&nbsp;on&nbsp;each&nbsp;lo</span><span>op&nbsp;iteration.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;</span><span>col</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>1</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Loop&nbsp;over&nbsp;each&nbsp;`key`&nbsp;and&nbsp;`value`&nbsp;from&nbsp;`this`&nbsp;ma</span><span>p&nbsp;in&nbsp;the&nbsp;insertion&nbsp;order.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>[</span><span>key</span><span>,</span><span>&nbsp;</span><span>value</span><span>]</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>this</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Initialize&nbsp;a&nbsp;`key`&nbsp;cell&nbsp;in&nbsp;the&nbsp;`result`&nbsp;table&nbsp;o</span><span>n&nbsp;row&nbsp;1.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>cell</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>col</span><span>,</span><span>&nbsp;</span><span>1</span><span>,</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>key</span><span>)</span><span>,</span><span>&nbsp;</span><span>bgcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.maroon</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>text_color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span><span>,</span><span>&nbsp;</span><span>text_size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>textSize</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Initialize&nbsp;a&nbsp;`value`&nbsp;cell&nbsp;in&nbsp;the&nbsp;`result`&nbsp;table</span><span>&nbsp;on&nbsp;row&nbsp;2.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>cell</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>col</span><span>,</span><span>&nbsp;</span><span>2</span><span>,</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>value</span><span>)</span><span>,</span><span>&nbsp;</span><span>bgcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.maroon</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>text_color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span><span>,</span><span>&nbsp;</span><span>text_size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>textSize</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Move&nbsp;to&nbsp;the&nbsp;next&nbsp;column&nbsp;index.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>col</span><span>&nbsp;</span><span>+=</span><span>&nbsp;</span><span>1</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>&nbsp;</span><span>//&nbsp;Return&nbsp;the&nbsp;`result`&nbsp;table.</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;with&nbsp;`string`&nbsp;keys&nbsp;and&nbsp;`float`&nbsp;values&nbsp;to&nbsp;ho</span><span>ld&nbsp;`length`-bar&nbsp;averages.</span></span><br><span><span>averages</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>//&nbsp;Put&nbsp;key-value&nbsp;pairs&nbsp;into&nbsp;the&nbsp;`averages`&nbsp;map.</span></span><br><span><span>averages</span><span>.</span><span>put</span><span>(</span><span>"Open"</span><span>,</span><span>&nbsp;</span><span>ta.sma</span><span>(</span><span>open</span><span>,</span><span>&nbsp;</span><span>length</span><span>))</span></span><br><span><span>averages</span><span>.</span><span>put</span><span>(</span><span>"High"</span><span>,</span><span>&nbsp;</span><span>ta.sma</span><span>(</span><span>high</span><span>,</span><span>&nbsp;</span><span>length</span><span>))</span></span><br><span><span>averages</span><span>.</span><span>put</span><span>(</span><span>"Low"</span><span>,</span><span>&nbsp;</span><span>ta.sma</span><span>(</span><span>low</span><span>,</span><span>&nbsp;</span><span>length</span><span>))</span></span><br><span><span>averages</span><span>.</span><span>put</span><span>(</span><span>"Close"</span><span>,</span><span>&nbsp;</span><span>ta.sma</span><span>(</span><span>close</span><span>,</span><span>&nbsp;</span><span>length</span><span>))</span></span><br><span><span>averages</span><span>.</span><span>put</span><span>(</span><span>"Volume"</span><span>,</span><span>&nbsp;</span><span>ta.sma</span><span>(</span><span>volume</span><span>,</span><span>&nbsp;</span><span>length</span><span>))</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;table.</span></span><br><span><span>string</span><span>&nbsp;</span><span>headerText</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>str.format</span><span>(</span><span>"{0}&nbsp;{1}-bar&nbsp;averages"</span><span>,</span><span>&nbsp;</span><span>"'"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>syminfo.tickerid</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"'"</span><span>,</span><span>&nbsp;</span><span>length</span><span>)</span></span><br><span><span>//&nbsp;Display&nbsp;the&nbsp;`averages`&nbsp;map&nbsp;in&nbsp;a&nbsp;`table`&nbsp;with&nbsp;th</span><span>e&nbsp;`headerText`.</span></span><br><span><span>averages</span><span>.</span><span>toTable</span><span>(</span><span>header</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>headerText</span><span>,</span><span>&nbsp;</span><span>textSize</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>txtSize</span><span>)</span></span><br><span><span></span></span><br>
```

## [Copying a map](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id12)

### [Shallow copies](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id13)

Scripts can make a _shallow copy_ of a map `id` using the [map.copy()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.copy) function. Modifications to a shallow copy do not affect the original `id` map or its internal insertion order.

For example, this script constructs an `m` map with the keys “A”, “B”, “C”, and “D” assigned to four [random](https://www.tradingview.com/pine-script-reference/v5/#fun_math.random) values between 0 and 10. It then creates an `mCopy` map as a shallow copy of `m` and updates the values associated with its keys. The script displays the key-value pairs in `m` and `mCopy` on the chart using our custom `debugLabel()` method:

![../_images/Maps-Copying-a-map-Shallow-copies-1.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Copying-a-map-Shallow-copies-1.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Shallow&nbsp;copy&nbsp;demo"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@function</span><span>&nbsp;Displays&nbsp;the&nbsp;key-value&nbsp;pairs&nbsp;of&nbsp;`this`&nbsp;map&nbsp;in&nbsp;a&nbsp;l</span><span>abel.</span></span><br><span><span>method</span><span>&nbsp;</span><span>debugLabel</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>this</span><span>,</span><span>&nbsp;</span><span>int</span><span>&nbsp;</span><span>barIndex</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>color</span><span>&nbsp;</span><span>bgColor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.blue</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>color</span><span>&nbsp;</span><span>textColor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span><span>,</span><span>&nbsp;</span><span>string</span><span>&nbsp;</span><span>note</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>""</span></span><br><span><span>&nbsp;</span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;text&nbsp;to&nbsp;display&nbsp;in&nbsp;the&nbsp;label.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>labelText</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>note</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\n{"</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>[</span><span>key</span><span>,</span><span>&nbsp;</span><span>value</span><span>]</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>this</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>labelText</span><span>&nbsp;</span><span>+=</span><span>&nbsp;</span><span>str.format</span><span>(</span><span>"{0}:&nbsp;{1},&nbsp;"</span><span>,</span><span>&nbsp;</span><span>key</span><span>,</span><span>&nbsp;</span><span>value</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>labelText</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>str.replace</span><span>(</span><span>labelText</span><span>,</span><span>&nbsp;</span><span>",&nbsp;"</span><span>,</span><span>&nbsp;</span><span>"}"</span><span>,</span><span>&nbsp;</span><span>this</span><span>.</span><span>size</span><span>()</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>if</span><span>&nbsp;</span><span>barstate.ishistory</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label</span><span>&nbsp;</span><span>result</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.new</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>barIndex</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>labelText</span><span>,</span><span>&nbsp;</span><span>color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>bgColor</span><span>,</span><span>&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.style_label_center</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>textcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>textColor</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.huge</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span></span></span><br><span><span>if</span><span>&nbsp;</span><span>bar_index</span><span>&nbsp;</span><span>==</span><span>&nbsp;</span><span>last_bar_index</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>1</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;of&nbsp;`string`&nbsp;keys&nbsp;and&nbsp;random&nbsp;`float`&nbsp;values.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Assign&nbsp;random&nbsp;values&nbsp;to&nbsp;an&nbsp;array&nbsp;of&nbsp;keys&nbsp;in&nbsp;`m`</span><span>.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>key</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>array.from</span><span>(</span><span>"A"</span><span>,</span><span>&nbsp;</span><span>"B"</span><span>,</span><span>&nbsp;</span><span>"C"</span><span>,</span><span>&nbsp;</span><span>"D"</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>put</span><span>(</span><span>key</span><span>,</span><span>&nbsp;</span><span>math.random</span><span>(</span><span>0</span><span>,</span><span>&nbsp;</span><span>10</span><span>))</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;`m`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mCopy</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>m</span><span>.</span><span>copy</span><span>()</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Assign&nbsp;the&nbsp;insertion&nbsp;order&nbsp;value&nbsp;`i`&nbsp;to&nbsp;each&nbsp;`k</span><span>ey`&nbsp;in&nbsp;`mCopy`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>[</span><span>i</span><span>,</span><span>&nbsp;</span><span>key</span><span>]</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>mCopy</span><span>.</span><span>keys</span><span>()</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mCopy</span><span>.</span><span>put</span><span>(</span><span>key</span><span>,</span><span>&nbsp;</span><span>i</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Display&nbsp;the&nbsp;labels.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>m</span><span>.</span><span>debugLabel</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>note</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>"Original"</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mCopy</span><span>.</span><span>debugLabel</span><span>(</span><span>bar_index</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>10</span><span>,</span><span>&nbsp;</span><span>color.purple</span><span>,</span><span>&nbsp;</span><span>note</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>"Copied&nbsp;and&nbsp;changed"</span><span>)</span></span><br><span><span></span></span><br>
```

### [Deep copies](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id14)

While a [shallow copy](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#pagemaps-copyingamap-shallowcopies) will suffice when copying maps that have values of a _fundamental type_, it’s important to remember that shallow copies of a map holding values of a _reference type_ ([line](https://www.tradingview.com/pine-script-reference/v5/#type_line), [linefill](https://www.tradingview.com/pine-script-reference/v5/#type_linefill), [box](https://www.tradingview.com/pine-script-reference/v5/#type_box), [polyline](https://www.tradingview.com/pine-script-reference/v5/#type_polyline), [label](https://www.tradingview.com/pine-script-reference/v5/#type_label), [table](https://www.tradingview.com/pine-script-reference/v5/#type_table), [chart.point](https://www.tradingview.com/pine-script-reference/v5/#type_chart.point) or a [UDT](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-userdefinedtypes)) point to the same objects as the original. Modifying the objects referenced by a shallow copy will affect the instances referenced by the original map and vice versa.

To ensure changes to objects referenced by a copied map do not affect instances referenced in other locations, one can make a _deep copy_ by creating a new map with key-value pairs containing copies of each value in the original map.

This example creates an `original` map of [string](https://www.tradingview.com/pine-script-reference/v5/#type_string) keys and [label](https://www.tradingview.com/pine-script-reference/v5/#type_label) values and [puts](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put) a key-value pair into it. The script copies the map to a `shallow` variable via the built-in [copy()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.copy) method, then to a `deep` variable using a custom `deepCopy()` method.

As we see from the chart, changes to the label retrieved from the `shallow` copy also affect the instance referenced by the `original` map, but changes to the one from the `deep` copy do not:

![../_images/Maps-Copying-a-map-Deep-copies-1.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Copying-a-map-Deep-copies-1.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Deep&nbsp;copy&nbsp;demo"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@function</span><span>&nbsp;Returns&nbsp;a&nbsp;deep&nbsp;copy&nbsp;of&nbsp;`this`&nbsp;map.</span></span><br><span><span>method</span><span>&nbsp;</span><span>deepCopy</span><span>(</span><span>map</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>label</span><span>&gt;</span><span>&nbsp;</span><span>this</span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;deep&nbsp;copy&nbsp;of&nbsp;`this`&nbsp;map.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>label</span><span>&gt;()</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Add&nbsp;key-value&nbsp;pairs&nbsp;with&nbsp;copies&nbsp;of&nbsp;each&nbsp;`value`</span><span>&nbsp;to&nbsp;the&nbsp;`result`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>[</span><span>key</span><span>,</span><span>&nbsp;</span><span>value</span><span>]</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>this</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>put</span><span>(</span><span>key</span><span>,</span><span>&nbsp;</span><span>value</span><span>.</span><span>copy</span><span>())</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>&nbsp;</span><span>//Return&nbsp;the&nbsp;`result`.</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;containing&nbsp;`string`&nbsp;keys&nbsp;and&nbsp;`label`&nbsp;values</span><span>.</span></span><br><span><span>var</span><span>&nbsp;</span><span>original</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>label</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>if</span><span>&nbsp;</span><span>bar_index</span><span>&nbsp;</span><span>==</span><span>&nbsp;</span><span>last_bar_index</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>1</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Put&nbsp;a&nbsp;new&nbsp;key-value&nbsp;pair&nbsp;into&nbsp;the&nbsp;`original`&nbsp;ma</span><span>p.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map.put</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>original</span><span>,</span><span>&nbsp;</span><span>"Test"</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"Original"</span><span>,</span><span>&nbsp;</span><span>textcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.huge</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;the&nbsp;`original`&nbsp;map.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>label</span><span>&gt;</span><span>&nbsp;</span><span>shallow</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>original</span><span>.</span><span>copy</span><span>()</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;deep&nbsp;copy&nbsp;of&nbsp;the&nbsp;`original`&nbsp;map.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>label</span><span>&gt;</span><span>&nbsp;</span><span>deep</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>original</span><span>.</span><span>deepCopy</span><span>()</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;"Test"&nbsp;label&nbsp;from&nbsp;the&nbsp;`shallow`&nbsp;copy.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label</span><span>&nbsp;</span><span>shallowLabel</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>shallow</span><span>.</span><span>get</span><span>(</span><span>"Test"</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;"Test"&nbsp;label&nbsp;from&nbsp;the&nbsp;`deep`&nbsp;copy.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label</span><span>&nbsp;</span><span>deepLabel</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>deep</span><span>.</span><span>get</span><span>(</span><span>"Test"</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Modify&nbsp;the&nbsp;"Test"&nbsp;label's&nbsp;`y`&nbsp;attribute&nbsp;in&nbsp;the&nbsp;</span><span>`original`&nbsp;map.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;This&nbsp;also&nbsp;affects&nbsp;the&nbsp;`shallowLabel`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>original</span><span>.</span><span>get</span><span>(</span><span>"Test"</span><span>)</span><span>.</span><span>set_y</span><span>(</span><span>label.all</span><span>.</span><span>size</span><span>())</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Modify&nbsp;the&nbsp;`shallowLabel`.&nbsp;Also&nbsp;modifies&nbsp;the&nbsp;"T</span><span>est"&nbsp;label&nbsp;in&nbsp;the&nbsp;`original`&nbsp;map.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>shallowLabel</span><span>.</span><span>set_text</span><span>(</span><span>"Shallow&nbsp;copy"</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>shallowLabel</span><span>.</span><span>set_color</span><span>(</span><span>color.red</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>shallowLabel</span><span>.</span><span>set_style</span><span>(</span><span>label.style_label_up</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Modify&nbsp;the&nbsp;`deepLabel`.&nbsp;Does&nbsp;not&nbsp;modify&nbsp;any&nbsp;oth</span><span>er&nbsp;label&nbsp;instance.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>deepLabel</span><span>.</span><span>set_text</span><span>(</span><span>"Deep&nbsp;copy"</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>deepLabel</span><span>.</span><span>set_color</span><span>(</span><span>color.navy</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>deepLabel</span><span>.</span><span>set_style</span><span>(</span><span>label.style_label_left</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>deepLabel</span><span>.</span><span>set_x</span><span>(</span><span>bar_index</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>5</span><span>)</span></span><br><span><span></span></span><br>
```

Note that:

-   The `deepCopy()` method loops through the `original` map, copying each `value` and [putting](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#pagemaps-readingandwriting-puttingandgettingkeyvaluepairs) key-value pairs containing the copies into a [new](https://www.tradingview.com/pine-script-reference/v5/#fun_map.new%3Ctype,type%3E) map instance.

## [Scope and history](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id15)

As with other collections in Pine, map variables leave historical trails on each bar, allowing a script to access past map instances assigned to a variable using the history-referencing operator [\[\]](https://www.tradingview.com/pine-script-reference/v5/#op_[]). Scripts can also assign maps to global variables and interact with them from the scopes of [functions](https://www.tradingview.com/pine-script-docs/en/v5/language/User-defined_functions.html#pageuserdefinedfunctions), [methods](https://www.tradingview.com/pine-script-docs/en/v5/language/Methods.html#pagemethods), and [conditional structures](https://www.tradingview.com/pine-script-docs/en/v5/language/Conditional_structures.html#pageconditionalstructures).

As an example, this script uses a global map and its history to calculate an aggregate set of [EMAs](https://www.tradingview.com/support/solutions/43000592270/). It declares a `globalData` map of [int](https://www.tradingview.com/pine-script-reference/v5/#type_int) keys and [float](https://www.tradingview.com/pine-script-reference/v5/#type_float) values, where each key in the map corresponds to the length of each EMA calculation. The user-defined `update()` function calculates each `key`\-length EMA by mixing the values from the `previous` map assigned to `globalData` with the current `source` value.

The script plots the [maximum](https://www.tradingview.com/pine-script-reference/v5/#fun_array.max) and [minimum](https://www.tradingview.com/pine-script-reference/v5/#fun_array.min) values in the global map’s [values()](https://www.tradingview.com/pine-script-reference/v5/#fun_map.values) array and the value from `globalData.get(50)` (i.e., the 50-bar EMA):

![../_images/Maps-Scope-and-history-1.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Scope-and-history-1.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Scope&nbsp;and&nbsp;history&nbsp;demo"</span><span>,</span><span>&nbsp;</span><span>overlay</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>true</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;source&nbsp;value&nbsp;for&nbsp;EMA&nbsp;calculation.</span></span><br><span><span>float</span><span>&nbsp;</span><span>source</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.source</span><span>(</span><span>close</span><span>,</span><span>&nbsp;</span><span>"Source"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;containing&nbsp;global&nbsp;key-value&nbsp;pairs.</span></span><br><span><span>globalData</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>int</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>//</span><span>@function</span><span>&nbsp;Calculates&nbsp;a&nbsp;set&nbsp;of&nbsp;EMAs&nbsp;and&nbsp;updates&nbsp;the&nbsp;key-valu</span><span>e&nbsp;pairs&nbsp;in&nbsp;`globalData`.</span></span><br><span><span>update</span><span>()</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;previous&nbsp;map&nbsp;instance&nbsp;assigned&nbsp;to&nbsp;`globalData</span><span>`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map</span><span>&lt;</span><span>int</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>previous</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>globalData</span><span>[</span><span>1</span><span>]</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Put&nbsp;key-value&nbsp;pairs&nbsp;with&nbsp;keys&nbsp;10-200&nbsp;into&nbsp;`glob</span><span>alData`&nbsp;if&nbsp;`previous`&nbsp;is&nbsp;`na`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>if</span><span>&nbsp;</span><span>na</span><span>(</span><span>previous</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>i</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>10</span><span>&nbsp;</span><span>to</span><span>&nbsp;</span><span>200</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>globalData</span><span>.</span><span>put</span><span>(</span><span>i</span><span>,</span><span>&nbsp;</span><span>source</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>else</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Iterate&nbsp;each&nbsp;`key`&nbsp;and&nbsp;`value`&nbsp;in&nbsp;the&nbsp;`previous</span><span>`&nbsp;map.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>[</span><span>key</span><span>,</span><span>&nbsp;</span><span>value</span><span>]</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>previous</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;smoothing&nbsp;parameter&nbsp;for&nbsp;the&nbsp;`key`-length&nbsp;EMA.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>float</span><span>&nbsp;</span><span>alpha</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>2.0</span><span>&nbsp;</span><span>/</span><span>&nbsp;</span><span>(</span><span>key</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>1.0</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;`key`-length&nbsp;EMA&nbsp;value.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>float</span><span>&nbsp;</span><span>ema</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>(</span><span>1.0</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>alpha</span><span>)</span><span>&nbsp;</span><span>*</span><span>&nbsp;</span><span>value</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>alpha</span><span>&nbsp;</span><span>*</span><span>&nbsp;</span><span>source</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Put&nbsp;the&nbsp;`key`-length&nbsp;`ema`&nbsp;into&nbsp;the&nbsp;`globalData</span><span>`&nbsp;map.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>globalData</span><span>.</span><span>put</span><span>(</span><span>key</span><span>,</span><span>&nbsp;</span><span>ema</span><span>)</span></span><br><span><span></span></span><br><span><span>//&nbsp;Update&nbsp;the&nbsp;`globalData`&nbsp;map.</span></span><br><span><span>update</span><span>()</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;array&nbsp;of&nbsp;values&nbsp;from&nbsp;`globalData`&nbsp;in&nbsp;their&nbsp;in</span><span>sertion&nbsp;order.</span></span><br><span><span>array</span><span>&lt;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>values</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>globalData</span><span>.</span><span>values</span><span>()</span></span><br><span><span></span></span><br><span><span>//&nbsp;Plot&nbsp;the&nbsp;max&nbsp;EMA,&nbsp;min&nbsp;EMA,&nbsp;and&nbsp;50-bar&nbsp;EMA&nbsp;value</span><span>s.</span></span><br><span><span>plot</span><span>(</span><span>values</span><span>.</span><span>max</span><span>()</span><span>,</span><span>&nbsp;</span><span>"Max&nbsp;EMA"</span><span>,</span><span>&nbsp;</span><span>color.green</span><span>,</span><span>&nbsp;</span><span>2</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>values</span><span>.</span><span>min</span><span>()</span><span>,</span><span>&nbsp;</span><span>"Min&nbsp;EMA"</span><span>,</span><span>&nbsp;</span><span>color.red</span><span>,</span><span>&nbsp;</span><span>2</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>globalData</span><span>.</span><span>get</span><span>(</span><span>50</span><span>)</span><span>,</span><span>&nbsp;</span><span>"50-bar&nbsp;EMA"</span><span>,</span><span>&nbsp;</span><span>color.orange</span><span>,</span><span>&nbsp;</span><span>3</span><span>)</span></span><br><span><span></span></span><br>
```

## [Maps of other collections](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#id16)

Maps cannot directly use other maps, [arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#pagearrays), or [matrices](https://www.tradingview.com/pine-script-docs/en/v5/language/Matrices.html#pagematrices) as values, but they can hold values of a [user-defined type](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-userdefinedtypes) that contains collections within its fields.

For example, suppose we want to create a “2D” map that uses [string](https://www.tradingview.com/pine-script-reference/v5/#type_string) keys to access _nested maps_ that hold pairs of [string](https://www.tradingview.com/pine-script-reference/v5/#type_string) keys and [float](https://www.tradingview.com/pine-script-reference/v5/#type_float) values. Since maps cannot use other collections as values, we will first create a _wrapper type_ with a field to hold a `map<string, float>` instance, like so:

```
<span><span>//</span><span>@type</span><span>&nbsp;A&nbsp;wrapper&nbsp;type&nbsp;for&nbsp;maps&nbsp;with&nbsp;`string`&nbsp;keys&nbsp;and&nbsp;`f</span><span>loat`&nbsp;values.</span></span><br><span><span>type</span><span>&nbsp;</span><span>Wrapper</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>data</span></span><br><span><span></span></span><br>
```

With our `Wrapper` type defined, we can create maps of [string](https://www.tradingview.com/pine-script-reference/v5/#type_string) keys and `Wrapper` values, where the `data` field of each value in the map points to a `map<string, float>` instance:

```
<span><span>mapOfMaps</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>Wrapper</span><span>&gt;()</span></span><br><span><span></span></span><br>
```

The script below uses this concept to construct a map containing maps that hold OHLCV data requested from multiple tickers. The user-defined `requestData()` function requests price and volume data from a ticker, creates a `<string, float>` map, [puts](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put) the data into it, then returns a `Wrapper` instance containing the new map.

The script [puts](https://www.tradingview.com/pine-script-reference/v5/#fun_map.put) the results from each call to `requestData()` into the `mapOfMaps`, then creates a [string](https://www.tradingview.com/pine-script-reference/v5/#type_string) representation of the nested maps with a user-defined `toString()` method, which it displays on the chart in a [label](https://www.tradingview.com/pine-script-reference/v5/#type_label):

![../_images/Maps-Maps-of-other-collections-1.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Maps-Maps-of-other-collections-1.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Nested&nbsp;map&nbsp;demo"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;timeframe&nbsp;of&nbsp;the&nbsp;requested&nbsp;data.</span></span><br><span><span>string</span><span>&nbsp;</span><span>tf</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.timeframe</span><span>(</span><span>"D"</span><span>,</span><span>&nbsp;</span><span>"Timeframe"</span><span>)</span></span><br><span><span>//&nbsp;Symbol&nbsp;inputs.</span></span><br><span><span>string</span><span>&nbsp;</span><span>symbol1</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.symbol</span><span>(</span><span>"EURUSD"</span><span>,</span><span>&nbsp;</span><span>"Symbol&nbsp;1"</span><span>)</span></span><br><span><span>string</span><span>&nbsp;</span><span>symbol2</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.symbol</span><span>(</span><span>"GBPUSD"</span><span>,</span><span>&nbsp;</span><span>"Symbol&nbsp;2"</span><span>)</span></span><br><span><span>string</span><span>&nbsp;</span><span>symbol3</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.symbol</span><span>(</span><span>"EURGBP"</span><span>,</span><span>&nbsp;</span><span>"Symbol&nbsp;3"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@type</span><span>&nbsp;A&nbsp;wrapper&nbsp;type&nbsp;for&nbsp;maps&nbsp;with&nbsp;`string`&nbsp;keys&nbsp;and&nbsp;`f</span><span>loat`&nbsp;values.</span></span><br><span><span>type</span><span>&nbsp;</span><span>Wrapper</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>map</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>data</span></span><br><span><span></span></span><br><span><span>//</span><span>@function</span><span>&nbsp;Returns&nbsp;a&nbsp;wrapped&nbsp;map&nbsp;containing&nbsp;OHLCV&nbsp;data&nbsp;from&nbsp;</span><span>the&nbsp;`tickerID`&nbsp;at&nbsp;the&nbsp;`timeframe`.</span></span><br><span><span>requestData</span><span>(</span><span>string</span><span>&nbsp;</span><span>tickerID</span><span>,</span><span>&nbsp;</span><span>string</span><span>&nbsp;</span><span>timeframe</span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Request&nbsp;a&nbsp;tuple&nbsp;of&nbsp;OHLCV&nbsp;values&nbsp;from&nbsp;the&nbsp;specif</span><span>ied&nbsp;ticker&nbsp;and&nbsp;timeframe.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>o</span><span>,</span><span>&nbsp;</span><span>h</span><span>,</span><span>&nbsp;</span><span>l</span><span>,</span><span>&nbsp;</span><span>c</span><span>,</span><span>&nbsp;</span><span>v</span><span>]</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>request.security</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>tickerID</span><span>,</span><span>&nbsp;</span><span>timeframe</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>open</span><span>,</span><span>&nbsp;</span><span>high</span><span>,</span><span>&nbsp;</span><span>low</span><span>,</span><span>&nbsp;</span><span>close</span><span>,</span><span>&nbsp;</span><span>volume</span><span>]</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;containing&nbsp;requested&nbsp;OHLCV&nbsp;data.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>float</span><span>&gt;()</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Put&nbsp;key-value&nbsp;pairs&nbsp;into&nbsp;the&nbsp;`result`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>put</span><span>(</span><span>"Open"</span><span>,</span><span>&nbsp;</span><span>o</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>put</span><span>(</span><span>"High"</span><span>,</span><span>&nbsp;</span><span>h</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>put</span><span>(</span><span>"Low"</span><span>,</span><span>&nbsp;</span><span>l</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>put</span><span>(</span><span>"Close"</span><span>,</span><span>&nbsp;</span><span>c</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>.</span><span>put</span><span>(</span><span>"Volume"</span><span>,</span><span>&nbsp;</span><span>v</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//Return&nbsp;the&nbsp;wrapped&nbsp;`result`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Wrapper</span><span>.</span><span>new</span><span>(</span><span>result</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@function</span><span>&nbsp;Returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;`this`&nbsp;map&nbsp;of&nbsp;`stri</span><span>ng`&nbsp;keys&nbsp;and&nbsp;`Wrapper`&nbsp;values.</span></span><br><span><span>method</span><span>&nbsp;</span><span>toString</span><span>(</span><span>map</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>Wrapper</span><span>&gt;</span><span>&nbsp;</span><span>this</span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;string&nbsp;representation&nbsp;of&nbsp;`this`&nbsp;map.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;</span><span>result</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>"{"</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Iterate&nbsp;over&nbsp;each&nbsp;`key1`&nbsp;and&nbsp;associated&nbsp;`wrappe</span><span>r`&nbsp;in&nbsp;`this`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>[</span><span>key1</span><span>,</span><span>&nbsp;</span><span>wrapper</span><span>]</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>this</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Add&nbsp;`key1`&nbsp;to&nbsp;the&nbsp;`result`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>&nbsp;</span><span>+=</span><span>&nbsp;</span><span>key1</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;`wrapper.data`&nbsp;map</span><span>.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;</span><span>innerStr</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>":&nbsp;{"</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Iterate&nbsp;over&nbsp;each&nbsp;`key2`&nbsp;and&nbsp;associated&nbsp;`value`</span><span>&nbsp;in&nbsp;the&nbsp;wrapped&nbsp;map.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>for</span><span>&nbsp;</span><span>[</span><span>key2</span><span>,</span><span>&nbsp;</span><span>value</span><span>]</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>wrapper</span><span>.</span><span>data</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Add&nbsp;the&nbsp;key-value&nbsp;pair's&nbsp;representation&nbsp;to&nbsp;`inn</span><span>erStr`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>innerStr</span><span>&nbsp;</span><span>+=</span><span>&nbsp;</span><span>str.format</span><span>(</span><span>"{0}:&nbsp;{1},&nbsp;"</span><span>,</span><span>&nbsp;</span><span>key2</span><span>,</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>value</span><span>))</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Replace&nbsp;the&nbsp;end&nbsp;of&nbsp;`innerStr`&nbsp;with&nbsp;"}"&nbsp;and&nbsp;add&nbsp;</span><span>to&nbsp;`result`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>&nbsp;</span><span>+=</span><span>&nbsp;</span><span>str.replace</span><span>(</span><span>innerStr</span><span>,</span><span>&nbsp;</span><span>",&nbsp;"</span><span>,</span><span>&nbsp;</span><span>"},\n"</span><span>,</span><span>&nbsp;</span><span>wrapper</span><span>.</span><span>data</span><span>.</span><span>size</span><span>()</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span></span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Replace&nbsp;the&nbsp;blank&nbsp;line&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;`result`&nbsp;w</span><span>ith&nbsp;"}".</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>str.replace</span><span>(</span><span>result</span><span>,</span><span>&nbsp;</span><span>",\n"</span><span>,</span><span>&nbsp;</span><span>"}"</span><span>,</span><span>&nbsp;</span><span>this</span><span>.</span><span>size</span><span>()</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>result</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;map&nbsp;of&nbsp;wrapped&nbsp;maps&nbsp;containing&nbsp;OHLCV&nbsp;data&nbsp;from&nbsp;</span><span>multiple&nbsp;tickers.</span></span><br><span><span>var</span><span>&nbsp;</span><span>mapOfMaps</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>map.new</span><span>&lt;</span><span>string</span><span>,</span><span>&nbsp;</span><span>Wrapper</span><span>&gt;()</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;label&nbsp;showing&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;`mapOfMaps`.</span></span><br><span><span>var</span><span>&nbsp;</span><span>debugLabel</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.new</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.navy</span><span>,</span><span>&nbsp;</span><span>textcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.huge</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.style_label_center</span><span>,</span><span>&nbsp;</span><span>text_font_family</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>font.family_monospace</span></span><br><span><span>&nbsp;</span><span>)</span></span><br><span><span></span></span><br><span><span>//&nbsp;Put&nbsp;wrapped&nbsp;maps&nbsp;into&nbsp;`mapOfMaps`.</span></span><br><span><span>mapOfMaps</span><span>.</span><span>put</span><span>(</span><span>symbol1</span><span>,</span><span>&nbsp;</span><span>requestData</span><span>(</span><span>symbol1</span><span>,</span><span>&nbsp;</span><span>tf</span><span>))</span></span><br><span><span>mapOfMaps</span><span>.</span><span>put</span><span>(</span><span>symbol2</span><span>,</span><span>&nbsp;</span><span>requestData</span><span>(</span><span>symbol2</span><span>,</span><span>&nbsp;</span><span>tf</span><span>))</span></span><br><span><span>mapOfMaps</span><span>.</span><span>put</span><span>(</span><span>symbol3</span><span>,</span><span>&nbsp;</span><span>requestData</span><span>(</span><span>symbol3</span><span>,</span><span>&nbsp;</span><span>tf</span><span>))</span></span><br><span><span></span></span><br><span><span>//&nbsp;Update&nbsp;the&nbsp;label.</span></span><br><span><span>debugLabel</span><span>.</span><span>set_text</span><span>(</span><span>mapOfMaps</span><span>.</span><span>toString</span><span>())</span></span><br><span><span>debugLabel</span><span>.</span><span>set_x</span><span>(</span><span>bar_index</span><span>)</span></span><br><span><span></span></span><br>
```

[

![../_images/TradingView_Logo_Block.svg](https://www.tradingview.com/pine-script-docs/en/v5/_images/TradingView_Logo_Block.svg)

](https://www.tradingview.com/)