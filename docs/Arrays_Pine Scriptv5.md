-   [Introduction](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#introduction)
-   [Declaring arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#declaring-arrays)
    -   [Using \`var\` and \`varip\` keywords](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#using-var-and-varip-keywords)
-   [Reading and writing array elements](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#reading-and-writing-array-elements)
-   [Looping through array elements](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#looping-through-array-elements)
-   [Scope](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#scope)
-   [History referencing](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#history-referencing)
-   [Inserting and removing array elements](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#inserting-and-removing-array-elements)
    -   [Inserting](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#inserting)
    -   [Removing](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#removing)
    -   [Using an array as a stack](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#using-an-array-as-a-stack)
    -   [Using an array as a queue](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#using-an-array-as-a-queue)
-   [Calculations on arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#calculations-on-arrays)
-   [Manipulating arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#manipulating-arrays)
    -   [Concatenation](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#concatenation)
    -   [Copying](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#copying)
    -   [Joining](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#joining)
    -   [Sorting](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#sorting)
    -   [Reversing](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#reversing)
    -   [Slicing](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#slicing)
-   [Searching arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#searching-arrays)
-   [Error handling](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#error-handling)
    -   [Index xx is out of bounds. Array size is yy](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#index-xx-is-out-of-bounds-array-size-is-yy)
    -   [Cannot call array methods when ID of array is ‘na’](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#cannot-call-array-methods-when-id-of-array-is-na)
    -   [Array is too large. Maximum size is 100000](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#array-is-too-large-maximum-size-is-100000)
    -   [Cannot create an array with a negative size](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#cannot-create-an-array-with-a-negative-size)
    -   [Cannot use shift() if array is empty.](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#cannot-use-shift-if-array-is-empty)
    -   [Cannot use pop() if array is empty.](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#cannot-use-pop-if-array-is-empty)
    -   [Index ‘from’ should be less than index ‘to’](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#index-from-should-be-less-than-index-to)
    -   [Slice is out of bounds of the parent array](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#slice-is-out-of-bounds-of-the-parent-array)

Note

This page contains advanced material. If you are a beginning Pine Script™ programmer, we recommend you become familiar with other, more accessible Pine Script™ features before you venture here.

## [Introduction](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id1)

Pine Script™ Arrays are one-dimensional collections that can hold multiple value references. Think of them as a better way to handle cases where one would otherwise need to explicitly declare a set of similar variables (e.g., `price00`, `price01`, `price02`, …).

All elements within an array must be of the same type, which can be a [built-in](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#id2) or a [user-defined type](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-userdefinedtypes), always qualified as “series”. Scripts reference arrays using an array ID similar to the IDs of lines, labels, and other special types. Pine Script™ does not use an indexing operator to reference individual array elements. Instead, functions including [array.get()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}get) and [array.set()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}set) read and write the values of array elements. We can use array values in expressions and functions that allow “series” values.

Scripts reference the elements of an array using an _index_, which starts at 0 and extends to the number of elements in the array minus one. Arrays in Pine Script™ can have a dynamic size that varies across bars, as one can change the number of elements in an array on each iteration of a script. Scripts can contain multiple array instances. The size of arrays is limited to 100,000 elements.

Note

We will use _beginning_ of an array to designate index 0, and _end_ of an array to designate the array’s element with the highest index value. We will also extend the meaning of _array_ to include array IDs, for the sake of brevity.

## [Declaring arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id2)

Pine Script™ uses the following syntax to declare arrays:

```
<span><span>[</span><span>var/varip</span><span>&nbsp;</span><span>][</span><span>array</span><span>&lt;</span><span>type</span><span>&gt;</span><span>/&lt;type</span><span>[]</span><span>&gt;</span><span>&nbsp;</span><span>]</span><span>&lt;</span><span>identifier</span><span>&gt;</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>&lt;</span><span>expression</span><span>&gt;</span></span><br><span><span></span></span><br>
```

Where `<type>` is a [type template](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-typetemplates) for the array that declares the type of values it will contain, and the `<expression>` returns either an array of the specified type or `na`.

When declaring a variable as an array, we can use the [array](https://www.tradingview.com/pine-script-reference/v5/#op_array) keyword followed by a [type template](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-typetemplates). Alternatively, we can use the `type` name followed by the `[]` modifier (not to be confused with the [\[\]](https://www.tradingview.com/pine-script-reference/v5/#op_[]) _history-referencing operator_).

Since Pine always uses type-specific functions to create arrays, the `array<type>/type[]` part of the declaration is redundant, except when declaring an array variable assigned to `na`. Even when not required, explicitly declaring the array type helps clearly state the intention to readers.

This line of code declares an array variable named `prices` that points to `na`. In this case, we must specify the type to declare that the variable can reference arrays containing “float” values:

We can also write the above example in this form:

When declaring an array and the `<expression>` is not `na`, use one of the following functions: [array.new<type>(size, initial\_value)](https://www.tradingview.com/pine-script-reference/v5/#fun_array.new%3Ctype%3E), [array.from()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}from), or [array.copy()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}copy). For `array.new<type>(size, initial_value)` functions, the arguments of the `size` and `initial_value` parameters can be “series” to allow dynamic sizing and initialization of array elements. The following example creates an array containing zero “float” elements, and this time, the array ID returned by the [array.new<float>()](https://www.tradingview.com/pine-script-reference/v5/#fun_array.new%3Ctype%3E) function call is assigned to `prices`:

```
<span><span>prices</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span></span></span><br>
```

Note

The `array.*` namespace also contains type-specific functions for creating arrays, including [array.new\_int()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}new_int), [array.new\_float()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}new_float), [array.new\_bool()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}new_bool), [array.new\_color()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}new_color), [array.new\_string()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}new_string), [array.new\_line()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}new_line), [array.new\_linefill()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}new_linefill), [array.new\_label()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}new_label), [array.new\_box()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}new_box) and [array.new\_table()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}new_table). The [array.new<type>()](https://www.tradingview.com/pine-script-reference/v5/#fun_array.new%3Ctype%3E) function can create an array of any type, including [user-defined types](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-userdefinedtypes).

The `initial_value` parameter of `array.new*` functions allows users to set all elements in the array to a specified value. If no argument is provided for `initial_value`, the array is filled with `na` values.

This line declares an array ID named `prices` pointing to an array containing two elements, each assigned to the bar’s `close` value:

```
<span><span>prices</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>2</span><span>,</span><span>&nbsp;</span><span>close</span><span>)</span></span><br><span><span></span></span><br>
```

To create an array and initialize its elements with different values, use [array.from()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}from). This function infers the array’s size and the type of elements it will hold from the arguments in the function call. As with `array.new*` functions, it accepts “series” arguments. All values supplied to the function must be of the same type.

For example, all three of these lines of code will create identical “bool” arrays with the same two elements:

```
<span><span>statesArray</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.from</span><span>(</span><span>close</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>open</span><span>,</span><span>&nbsp;</span><span>high</span><span>&nbsp;</span><span>!=</span><span>&nbsp;</span><span>close</span><span>)</span></span><br><span><span>bool</span><span>[]</span><span>&nbsp;</span><span>statesArray</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.from</span><span>(</span><span>close</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>open</span><span>,</span><span>&nbsp;</span><span>high</span><span>&nbsp;</span><span>!=</span><span>&nbsp;</span><span>close</span><span>)</span></span><br><span><span>array</span><span>&lt;</span><span>bool</span><span>&gt;</span><span>&nbsp;</span><span>statesArray</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.from</span><span>(</span><span>close</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>open</span><span>,</span><span>&nbsp;</span><span>high</span><span>&nbsp;</span><span>!=</span><span>&nbsp;</span><span>close</span><span>)</span></span><br><span><span></span></span><br>
```

### [Using \`var\` and \`varip\` keywords](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id3)

Users can utilize [var](https://www.tradingview.com/pine-script-reference/v5/#op_var) and [varip](https://www.tradingview.com/pine-script-reference/v5/#op_varip) keywords to instruct a script to declare an array variable only once on the first iteration of the script on the first chart bar. Array variables declared using these keywords point to the same array instances until explicitly reassigned, allowing an array and its element references to persist across bars.

When declaring an array variable using these keywords and pushing a new value to the end of the referenced array on each bar, the array will grow by one on each bar and be of size `bar_index + 1` ([bar\_index](https://www.tradingview.com/pine-script-reference/v5/#var_bar_index) starts at zero) by the time the script executes on the last bar, as this code demonstrates:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Using&nbsp;`var`"</span><span>)</span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;An&nbsp;array&nbsp;that&nbsp;expands&nbsp;its&nbsp;size&nbsp;by&nbsp;1&nbsp;on&nbsp;each&nbsp;bar.</span></span><br><span><span>var</span><span>&nbsp;</span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>close</span><span>)</span></span><br><span><span></span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.islast</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;string&nbsp;containing&nbsp;the&nbsp;size&nbsp;of&nbsp;`a`&nbsp;and&nbsp;the&nbsp;curre</span><span>nt&nbsp;`bar_index`&nbsp;value.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>string</span><span>&nbsp;</span><span>labelText</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>"Array&nbsp;size:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>.</span><span>size</span><span>())</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\nbar_index:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>bar_index</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Display&nbsp;the&nbsp;`labelText`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>labelText</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.large</span><span>)</span></span><br><span><span></span></span><br>
```

The same code without the [var](https://www.tradingview.com/pine-script-reference/v5/#op_var) keyword would re-declare the array on each bar. In this case, after execution of the [array.push()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}push) call, the [a.size()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}size) call would return a value of 1.

Note

Array variables declared using [varip](https://www.tradingview.com/pine-script-reference/v5/#kw_varip) behave as ones using [var](https://www.tradingview.com/pine-script-reference/v5/#kw_var) on historical data, but they update their values for realtime bars (i.e., the bars since the script’s last compilation) on each new price tick. Arrays assigned to [varip](https://www.tradingview.com/pine-script-reference/v5/#kw_varip) variables can only hold [int](https://www.tradingview.com/pine-script-reference/v5/#type_int), [float](https://www.tradingview.com/pine-script-reference/v5/#type_float), [bool](https://www.tradingview.com/pine-script-reference/v5/#type_bool), [color](https://www.tradingview.com/pine-script-reference/v5/#type_color), or [string](https://www.tradingview.com/pine-script-reference/v5/#type_string) types or [user-defined types](https://www.tradingview.com/pine-script-docs/en/v5/language/Type_system.html#pagetypesystem-userdefinedtypes) that exclusively contain within their fields these types or collections (arrays, [matrices](https://www.tradingview.com/pine-script-docs/en/v5/language/Matrices.html#pagematrices), or [maps](https://www.tradingview.com/pine-script-docs/en/v5/language/Maps.html#pagemaps)) of these types.

## [Reading and writing array elements](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id4)

Scripts can write values to existing individual array elements using [array.set(id, index, value)](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}set), and read using [array.get(id, index)](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}get). When using these functions, it is imperative that the `index` in the function call is always less than or equal to the array’s size (because array indices start at zero). To get the size of an array, use the [array.size(id)](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}size) function.

The following example uses the [set()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}set) method to populate a `fillColors` array with instances of one base color using different transparency levels. It then uses [array.get()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}get) to retrieve one of the colors from the array based on the location of the bar with the highest price within the last `lookbackInput` bars:

![../_images/Arrays-ReadingAndWriting-DistanceFromHigh.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Arrays-ReadingAndWriting-DistanceFromHigh.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Distance&nbsp;from&nbsp;high"</span><span>,</span><span>&nbsp;</span><span>""</span><span>,</span><span>&nbsp;</span><span>true</span><span>)</span></span><br><span><span>lookbackInput</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.int</span><span>(</span><span>100</span><span>)</span></span><br><span><span>FILL_COLOR</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.green</span></span><br><span><span>//&nbsp;Declare&nbsp;array&nbsp;and&nbsp;set&nbsp;its&nbsp;values&nbsp;on&nbsp;the&nbsp;first&nbsp;b</span><span>ar&nbsp;only.</span></span><br><span><span>var</span><span>&nbsp;</span><span>fillColors</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>color</span><span>&gt;(</span><span>5</span><span>)</span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.isfirst</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Initialize&nbsp;the&nbsp;array&nbsp;elements&nbsp;with&nbsp;progressivel</span><span>y&nbsp;lighter&nbsp;shades&nbsp;of&nbsp;the&nbsp;fill&nbsp;color.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>fillColors</span><span>.</span><span>set</span><span>(</span><span>0</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>70</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>fillColors</span><span>.</span><span>set</span><span>(</span><span>1</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>75</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>fillColors</span><span>.</span><span>set</span><span>(</span><span>2</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>80</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>fillColors</span><span>.</span><span>set</span><span>(</span><span>3</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>85</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>fillColors</span><span>.</span><span>set</span><span>(</span><span>4</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>90</span><span>))</span></span><br><span><span></span></span><br><span><span>//&nbsp;Find&nbsp;the&nbsp;offset&nbsp;to&nbsp;highest&nbsp;high.&nbsp;Change&nbsp;its&nbsp;sig</span><span>n&nbsp;because&nbsp;the&nbsp;function&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value.</span></span><br><span><span>lastHiBar</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>ta.highestbars</span><span>(</span><span>high</span><span>,</span><span>&nbsp;</span><span>lookbackInput</span><span>)</span></span><br><span><span>//&nbsp;Convert&nbsp;the&nbsp;offset&nbsp;to&nbsp;an&nbsp;array&nbsp;index,&nbsp;capping&nbsp;i</span><span>t&nbsp;to&nbsp;4&nbsp;to&nbsp;avoid&nbsp;a&nbsp;runtime&nbsp;error.</span></span><br><span><span>//&nbsp;The&nbsp;index&nbsp;used&nbsp;by&nbsp;`array.get()`&nbsp;will&nbsp;be&nbsp;the&nbsp;equ</span><span>ivalent&nbsp;of&nbsp;`floor(fillNo)`.</span></span><br><span><span>fillNo</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>math.min</span><span>(</span><span>lastHiBar</span><span>&nbsp;</span><span>/</span><span>&nbsp;</span><span>(</span><span>lookbackInput</span><span>&nbsp;</span><span>/</span><span>&nbsp;</span><span>5</span><span>)</span><span>,</span><span>&nbsp;</span><span>4</span><span>)</span></span><br><span><span>//&nbsp;Set&nbsp;background&nbsp;to&nbsp;a&nbsp;progressively&nbsp;lighter&nbsp;fill&nbsp;</span><span>with&nbsp;increasing&nbsp;distance&nbsp;from&nbsp;location&nbsp;of&nbsp;highest&nbsp;</span><span>high.</span></span><br><span><span>bgcolor</span><span>(</span><span>array.get</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>fillNo</span><span>))</span></span><br><span><span>//&nbsp;Plot&nbsp;key&nbsp;values&nbsp;to&nbsp;the&nbsp;Data&nbsp;Window&nbsp;for&nbsp;debuggin</span><span>g.</span></span><br><span><span>plotchar</span><span>(</span><span>lastHiBar</span><span>,</span><span>&nbsp;</span><span>"lastHiBar"</span><span>,</span><span>&nbsp;</span><span>""</span><span>,</span><span>&nbsp;</span><span>location.top</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.tiny</span><span>)</span></span><br><span><span>plotchar</span><span>(</span><span>fillNo</span><span>,</span><span>&nbsp;</span><span>"fillNo"</span><span>,</span><span>&nbsp;</span><span>""</span><span>,</span><span>&nbsp;</span><span>location.top</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.tiny</span><span>)</span></span><br><span><span></span></span><br>
```

Another technique for initializing the elements in an array is to create an _empty array_ (an array with no elements), then use [array.push()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}push) to append **new** elements to the end of the array, increasing the size of the array by one on each call. The following code is functionally identical to the initialization section from the preceding script:

```
<span><span>//&nbsp;Declare&nbsp;array&nbsp;and&nbsp;set&nbsp;its&nbsp;values&nbsp;on&nbsp;the&nbsp;first&nbsp;b</span><span>ar&nbsp;only.</span></span><br><span><span>var</span><span>&nbsp;</span><span>fillColors</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>color</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.isfirst</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Initialize&nbsp;the&nbsp;array&nbsp;elements&nbsp;with&nbsp;progressivel</span><span>y&nbsp;lighter&nbsp;shades&nbsp;of&nbsp;the&nbsp;fill&nbsp;color.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.push</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>70</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.push</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>75</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.push</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>80</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.push</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>85</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.push</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>90</span><span>))</span></span><br><span><span></span></span><br>
```

This code is equivalent to the one above, but it uses [array.unshift()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}unshift) to insert new elements at the _beginning_ of the `fillColors` array:

```
<span><span>//&nbsp;Declare&nbsp;array&nbsp;and&nbsp;set&nbsp;its&nbsp;values&nbsp;on&nbsp;the&nbsp;first&nbsp;b</span><span>ar&nbsp;only.</span></span><br><span><span>var</span><span>&nbsp;</span><span>fillColors</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>color</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.isfirst</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Initialize&nbsp;the&nbsp;array&nbsp;elements&nbsp;with&nbsp;progressivel</span><span>y&nbsp;lighter&nbsp;shades&nbsp;of&nbsp;the&nbsp;fill&nbsp;color.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.unshift</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>90</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.unshift</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>85</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.unshift</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>80</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.unshift</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>75</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.unshift</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>70</span><span>))</span></span><br><span><span></span></span><br>
```

We can also use [array.from()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}from) to create the same `fillColors` array with a single function call:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Using&nbsp;`var`"</span><span>)</span></span><br><span><span>FILL_COLOR</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.green</span></span><br><span><span>var</span><span>&nbsp;</span><span>array</span><span>&lt;</span><span>color</span><span>&gt;</span><span>&nbsp;</span><span>fillColors</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.from</span><span>(</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>70</span><span>)</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>75</span><span>)</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>80</span><span>)</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>85</span><span>)</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>color.new</span><span>(</span><span>FILL_COLOR</span><span>,</span><span>&nbsp;</span><span>90</span><span>)</span></span><br><span><span>&nbsp;</span><span>)</span></span><br><span><span>//&nbsp;Cycle&nbsp;background&nbsp;through&nbsp;the&nbsp;array's&nbsp;colors.</span></span><br><span><span>bgcolor</span><span>(</span><span>array.get</span><span>(</span><span>fillColors</span><span>,</span><span>&nbsp;</span><span>bar_index</span><span>&nbsp;</span><span>%</span><span>&nbsp;</span><span>(</span><span>fillColors</span><span>.</span><span>size</span><span>())))</span></span><br><span><span></span></span><br>
```

The [array.fill(id, value, index\_from, index\_to)](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}fill) function points all array elements, or the elements within the `index_from` to `index_to` range, to a specified `value`. Without the last two optional parameters, the function fills the whole array, so:

```
<span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>10</span><span>,</span><span>&nbsp;</span><span>close</span><span>)</span></span><br><span><span></span></span><br>
```

and:

```
<span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>10</span><span>)</span></span><br><span><span>a</span><span>.</span><span>fill</span><span>(</span><span>close</span><span>)</span></span><br><span><span></span></span><br>
```

are equivalent, but:

```
<span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>10</span><span>)</span></span><br><span><span>a</span><span>.</span><span>fill</span><span>(</span><span>close</span><span>,</span><span>&nbsp;</span><span>1</span><span>,</span><span>&nbsp;</span><span>3</span><span>)</span></span><br><span><span></span></span><br>
```

only fills the second and third elements (at index 1 and 2) of the array with `close`. Note how [array.fill()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}fill)’s last parameter, `index_to`, must be one greater than the last index the function will fill. The remaining elements will hold `na` values, as the [array.new()](https://www.tradingview.com/pine-script-reference/v5/#fun_array.new%3Ctype%3E) function call does not contain an `initial_value` argument.

## [Looping through array elements](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id5)

When looping through an array’s element indices and the array’s size is unknown, one can use the [array.size()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}size) function to get the maximum index value. For example:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Protected&nbsp;`for`&nbsp;loop"</span><span>,</span><span>&nbsp;</span><span>overlay</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>true</span><span>)</span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;An&nbsp;array&nbsp;of&nbsp;`close`&nbsp;prices&nbsp;from&nbsp;the&nbsp;1-minute&nbsp;time</span><span>frame.</span></span><br><span><span>array</span><span>&lt;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>request.security_lower_tf</span><span>(</span><span>syminfo.tickerid</span><span>,</span><span>&nbsp;</span><span>"1"</span><span>,</span><span>&nbsp;</span><span>close</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;elements&nbsp;in&nbsp;`a`.</span></span><br><span><span>string</span><span>&nbsp;</span><span>labelText</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>""</span></span><br><span><span>for</span><span>&nbsp;</span><span>i</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>0</span><span>&nbsp;</span><span>to</span><span>&nbsp;</span><span>(</span><span>array.size</span><span>(</span><span>a</span><span>)</span><span>&nbsp;</span><span>==</span><span>&nbsp;</span><span>0</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>na</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>array.size</span><span>(</span><span>a</span><span>)</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>labelText</span><span>&nbsp;</span><span>+=</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>array.get</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>i</span><span>))</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\n"</span></span><br><span><span></span></span><br><span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>high</span><span>,</span><span>&nbsp;</span><span>text</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>labelText</span><span>)</span></span><br><span><span></span></span><br>
```

Note that:

-   We use the [request.security\_lower\_tf()](https://www.tradingview.com/pine-script-reference/v5/#fun_request{dot}security_lower_tf) function which returns an array of [close](https://www.tradingview.com/pine-script-reference/v5/#var_close) prices at the `1 minute` timeframe.
-   This code example will throw an error if you use it on a chart timeframe smaller than `1 minute`.
-   [for](https://www.tradingview.com/pine-script-reference/v5/#op_for) loops do not execute if the `to` expression is [na](https://www.tradingview.com/pine-script-reference/v5/#var_na). Note that the `to` value is only evaluated once upon entry.

An alternative method to loop through an array is to use a [for…in](https://www.tradingview.com/pine-script-reference/v5/#op_for{dot}{dot}{dot}in) loop. This approach is a variation of the standard for loop that can iterate over the value references and indices in an array. Here is an example of how we can write the code example from above using a `for...in` loop:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"`for...in`&nbsp;loop"</span><span>,</span><span>&nbsp;</span><span>overlay</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>true</span><span>)</span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;An&nbsp;array&nbsp;of&nbsp;`close`&nbsp;prices&nbsp;from&nbsp;the&nbsp;1-minute&nbsp;time</span><span>frame.</span></span><br><span><span>array</span><span>&lt;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>request.security_lower_tf</span><span>(</span><span>syminfo.tickerid</span><span>,</span><span>&nbsp;</span><span>"1"</span><span>,</span><span>&nbsp;</span><span>close</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;elements&nbsp;in&nbsp;`a`.</span></span><br><span><span>string</span><span>&nbsp;</span><span>labelText</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>""</span></span><br><span><span>for</span><span>&nbsp;</span><span>price</span><span>&nbsp;</span><span>in</span><span>&nbsp;</span><span>a</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>labelText</span><span>&nbsp;</span><span>+=</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>price</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\n"</span></span><br><span><span></span></span><br><span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>high</span><span>,</span><span>&nbsp;</span><span>text</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>labelText</span><span>)</span></span><br><span><span></span></span><br>
```

Note that:

-   [for…in](https://www.tradingview.com/pine-script-reference/v5/#op_for{dot}{dot}{dot}in) loops can return a tuple containing each index and corresponding element. For example, `for [i, price] in a` returns the `i` index and `price` value for each element in `a`.

A [while](https://www.tradingview.com/pine-script-reference/v5/#op_while) loop statement can also be used:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"`while`&nbsp;loop"</span><span>,</span><span>&nbsp;</span><span>overlay</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>true</span><span>)</span></span><br><span><span>array</span><span>&lt;</span><span>float</span><span>&gt;</span><span>&nbsp;</span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>request.security_lower_tf</span><span>(</span><span>syminfo.tickerid</span><span>,</span><span>&nbsp;</span><span>"1"</span><span>,</span><span>&nbsp;</span><span>close</span><span>)</span></span><br><span><span></span></span><br><span><span>string</span><span>&nbsp;</span><span>labelText</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>""</span></span><br><span><span>int</span><span>&nbsp;</span><span>i</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>0</span></span><br><span><span>while</span><span>&nbsp;</span><span>i</span><span>&nbsp;</span><span>&lt;</span><span>&nbsp;</span><span>array.size</span><span>(</span><span>a</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>labelText</span><span>&nbsp;</span><span>+=</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>array.get</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>i</span><span>))</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\n"</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>i</span><span>&nbsp;</span><span>+=</span><span>&nbsp;</span><span>1</span></span><br><span><span></span></span><br><span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>high</span><span>,</span><span>&nbsp;</span><span>text</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>labelText</span><span>)</span></span><br><span><span></span></span><br>
```

## [Scope](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id6)

Users can declare arrays within the global scope of a script, as well as the local scopes of [functions](https://www.tradingview.com/pine-script-docs/en/v5/language/User-defined_functions.html#pageuserdefinedfunctions), [methods](https://www.tradingview.com/pine-script-docs/en/v5/language/Methods.html#pagemethods), and [conditional structures](https://www.tradingview.com/pine-script-docs/en/v5/language/Conditional_structures.html#pageconditionalstructures). Unlike some of the other built-in types, namely _fundamental_ types, scripts can modify globally-assigned arrays from within local scopes, allowing users to implement global variables that any function in the script can directly interact with. We use the functionality here to calculate progressively lower or higher price levels:

![../_images/Arrays-Scope-Bands.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Arrays-Scope-Bands.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Bands"</span><span>,</span><span>&nbsp;</span><span>""</span><span>,</span><span>&nbsp;</span><span>true</span><span>)</span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;distance&nbsp;ratio&nbsp;between&nbsp;plotted&nbsp;price&nbsp;levels.</span></span><br><span><span>factorInput</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>1</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>(</span><span>input.float</span><span>(</span><span>-2.</span><span>,</span><span>&nbsp;</span><span>"Step&nbsp;%"</span><span>)</span><span>&nbsp;</span><span>/</span><span>&nbsp;</span><span>100</span><span>)</span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;single-value&nbsp;array&nbsp;holding&nbsp;the&nbsp;lowest&nbsp;`ohlc4`&nbsp;v</span><span>alue&nbsp;within&nbsp;a&nbsp;50&nbsp;bar&nbsp;window&nbsp;from&nbsp;10&nbsp;bars&nbsp;back.</span></span><br><span><span>level</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>1</span><span>,</span><span>&nbsp;</span><span>ta.lowest</span><span>(</span><span>ohlc4</span><span>,</span><span>&nbsp;</span><span>50</span><span>)[</span><span>10</span><span>])</span></span><br><span><span></span></span><br><span><span>nextLevel</span><span>(</span><span>val</span><span>)</span><span>&nbsp;</span><span>=&gt;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>newLevel</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>level</span><span>.</span><span>get</span><span>(</span><span>0</span><span>)</span><span>&nbsp;</span><span>*</span><span>&nbsp;</span><span>val</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Write&nbsp;new&nbsp;level&nbsp;to&nbsp;the&nbsp;global&nbsp;`level`&nbsp;array&nbsp;so&nbsp;</span><span>we&nbsp;can&nbsp;use&nbsp;it&nbsp;as&nbsp;the&nbsp;base&nbsp;in&nbsp;the&nbsp;next&nbsp;function&nbsp;cal</span><span>l.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>level</span><span>.</span><span>set</span><span>(</span><span>0</span><span>,</span><span>&nbsp;</span><span>newLevel</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>newLevel</span></span><br><span><span></span></span><br><span><span>plot</span><span>(</span><span>nextLevel</span><span>(</span><span>1</span><span>))</span></span><br><span><span>plot</span><span>(</span><span>nextLevel</span><span>(</span><span>factorInput</span><span>))</span></span><br><span><span>plot</span><span>(</span><span>nextLevel</span><span>(</span><span>factorInput</span><span>))</span></span><br><span><span>plot</span><span>(</span><span>nextLevel</span><span>(</span><span>factorInput</span><span>))</span></span><br><span><span></span></span><br>
```

## [History referencing](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id7)

Pine Script™’s history-referencing operator [\[ \]](https://www.tradingview.com/pine-script-reference/v5/#op_[]) can access the history of array variables, allowing scripts to interact with past array instances previously assigned to a variable.

To illustrate this, let’s create a simple example to show how one can fetch the previous bar’s `close` value in two equivalent ways. This script uses the [\[ \]](https://www.tradingview.com/pine-script-reference/v5/#op_[]) operator to get the array instance assigned to `a` on the previous bar, then uses the [get()](https://www.tradingview.com/pine-script-reference/v5/#fun_array.get) method to retrieve the value of the first element (`previousClose1`). For `previousClose2`, we use the history-referencing operator on the `close` variable directly to retrieve the value. As we see from the plots, `previousClose1` and `previousClose2` both return the same value:

![../_images/Arrays-History-referencing.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Arrays-History-referencing.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"History&nbsp;referencing"</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;A&nbsp;single-value&nbsp;array&nbsp;declared&nbsp;on&nbsp;each&nbsp;bar.</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>1</span><span>)</span></span><br><span><span>//&nbsp;Set&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;only&nbsp;element&nbsp;in&nbsp;`a`&nbsp;to&nbsp;`cl</span><span>ose`.</span></span><br><span><span>array.set</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>close</span><span>)</span></span><br><span><span></span></span><br><span><span>//</span><span>@variable</span><span>&nbsp;The&nbsp;array&nbsp;instance&nbsp;assigned&nbsp;to&nbsp;`a`&nbsp;on&nbsp;the&nbsp;previou</span><span>s&nbsp;bar.</span></span><br><span><span>previous</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>a</span><span>[</span><span>1</span><span>]</span></span><br><span><span></span></span><br><span><span>previousClose1</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>na</span><span>(</span><span>previous</span><span>)</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>na</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>previous</span><span>.</span><span>get</span><span>(</span><span>0</span><span>)</span></span><br><span><span>previousClose2</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>close</span><span>[</span><span>1</span><span>]</span></span><br><span><span></span></span><br><span><span>plot</span><span>(</span><span>previousClose1</span><span>,</span><span>&nbsp;</span><span>"previousClose1"</span><span>,</span><span>&nbsp;</span><span>color.gray</span><span>,</span><span>&nbsp;</span><span>6</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>previousClose2</span><span>,</span><span>&nbsp;</span><span>"previousClose2"</span><span>,</span><span>&nbsp;</span><span>color.white</span><span>,</span><span>&nbsp;</span><span>2</span><span>)</span></span><br><span><span></span></span><br>
```

## [Inserting and removing array elements](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id8)

### [Inserting](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id9)

The following three functions can insert new elements into an array.

[array.unshift()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}unshift) inserts a new element at the beginning of an array (index 0) and increases the index values of any existing elements by one.

[array.insert()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}insert) inserts a new element at the specified `index` and increases the index of existing elements at or after the `index` by one.

![../_images/Arrays-InsertingAndRemovingArrayElements-Insert.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Arrays-InsertingAndRemovingArrayElements-Insert.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"`array.insert()`"</span><span>)</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>5</span><span>,</span><span>&nbsp;</span><span>0</span><span>)</span></span><br><span><span>for</span><span>&nbsp;</span><span>i</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>0</span><span>&nbsp;</span><span>to</span><span>&nbsp;</span><span>4</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.set</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>i</span><span>,</span><span>&nbsp;</span><span>i</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.islast</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"BEFORE\na:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>)</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.large</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.insert</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>2</span><span>,</span><span>&nbsp;</span><span>999</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"AFTER\na:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>)</span><span>,</span><span>&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.style_label_up</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.large</span><span>)</span></span><br><span><span></span></span><br>
```

[array.push()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}push) adds a new element at the end of an array.

### [Removing](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id10)

These four functions remove elements from an array. The first three also return the value of the removed element.

[array.remove()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}remove) removes the element at the specified `index` and returns that element’s value.

[array.shift()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}shift) removes the first element from an array and returns its value.

[array.pop()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}pop) removes the last element of an array and returns its value.

[array.clear()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}clear) removes all elements from an array. Note that clearing an array won’t delete any objects its elements referenced. See the example below that illustrates how this works:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"`array.clear()`&nbsp;example"</span><span>,</span><span>&nbsp;</span><span>overlay</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>true</span><span>)</span></span><br><span><span></span></span><br><span><span>//&nbsp;Create&nbsp;a&nbsp;label&nbsp;array&nbsp;and&nbsp;add&nbsp;a&nbsp;label&nbsp;to&nbsp;the&nbsp;arr</span><span>ay&nbsp;on&nbsp;each&nbsp;new&nbsp;bar.</span></span><br><span><span>var</span><span>&nbsp;</span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>label</span><span>&gt;()</span></span><br><span><span>label</span><span>&nbsp;</span><span>lbl</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>high</span><span>,</span><span>&nbsp;</span><span>"Text"</span><span>,</span><span>&nbsp;</span><span>color</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.red</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>lbl</span><span>)</span></span><br><span><span></span></span><br><span><span>var</span><span>&nbsp;</span><span>table</span><span>&nbsp;</span><span>t</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>table.new</span><span>(</span><span>position.top_right</span><span>,</span><span>&nbsp;</span><span>1</span><span>,</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>//&nbsp;Clear&nbsp;the&nbsp;array&nbsp;on&nbsp;the&nbsp;last&nbsp;bar.&nbsp;This&nbsp;doesn't&nbsp;r</span><span>emove&nbsp;the&nbsp;labels&nbsp;from&nbsp;the&nbsp;chart.</span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.islast</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.clear</span><span>(</span><span>a</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>table.cell</span><span>(</span><span>t</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"Array&nbsp;elements&nbsp;count:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>array.size</span><span>(</span><span>a</span><span>))</span><span>,</span><span>&nbsp;</span><span>bgcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.yellow</span><span>)</span></span><br><span><span></span></span><br>
```

### [Using an array as a stack](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id11)

Stacks are LIFO (last in, first out) constructions. They behave somewhat like a vertical pile of books to which books can only be added or removed one at a time, always from the top. Pine Script™ arrays can be used as a stack, in which case we use the [array.push()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}push) and [array.pop()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}pop) functions to add and remove elements at the end of the array.

`array.push(prices, close)` will add a new element to the end of the `prices` array, increasing the array’s size by one.

`array.pop(prices)` will remove the end element from the `prices` array, return its value and decrease the array’s size by one.

See how the functions are used here to track successive lows in rallies:

![../_images/Arrays-InsertingAndRemovingArrayElements-LowsFromNewHighs.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Arrays-InsertingAndRemovingArrayElements-LowsFromNewHighs.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Lows&nbsp;from&nbsp;new&nbsp;highs"</span><span>,</span><span>&nbsp;</span><span>""</span><span>,</span><span>&nbsp;</span><span>true</span><span>)</span></span><br><span><span>var</span><span>&nbsp;</span><span>lows</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>flushLows</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>false</span></span><br><span><span></span></span><br><span><span>//&nbsp;Remove&nbsp;last&nbsp;element&nbsp;from&nbsp;the&nbsp;stack&nbsp;when&nbsp;`_cond`</span><span>&nbsp;is&nbsp;true.</span></span><br><span><span>array_pop</span><span>(</span><span>id</span><span>,</span><span>&nbsp;</span><span>cond</span><span>)</span><span>&nbsp;</span><span>=&gt;</span><span>&nbsp;</span><span>cond</span><span>&nbsp;</span><span>and</span><span>&nbsp;</span><span>array.size</span><span>(</span><span>id</span><span>)</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>0</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>array.pop</span><span>(</span><span>id</span><span>)</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>float</span><span>(</span><span>na</span><span>)</span></span><br><span><span></span></span><br><span><span>if</span><span>&nbsp;</span><span>ta.rising</span><span>(</span><span>high</span><span>,</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Rising&nbsp;highs;&nbsp;push&nbsp;a&nbsp;new&nbsp;low&nbsp;on&nbsp;the&nbsp;stack.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>lows</span><span>.</span><span>push</span><span>(</span><span>low</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Force&nbsp;the&nbsp;return&nbsp;type&nbsp;of&nbsp;this&nbsp;`if`&nbsp;block&nbsp;to&nbsp;be&nbsp;</span><span>the&nbsp;same&nbsp;as&nbsp;that&nbsp;of&nbsp;the&nbsp;next&nbsp;block.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>bool</span><span>(</span><span>na</span><span>)</span></span><br><span><span>else</span><span>&nbsp;</span><span>if</span><span>&nbsp;</span><span>lows</span><span>.</span><span>size</span><span>()</span><span>&nbsp;</span><span>&gt;=</span><span>&nbsp;</span><span>4</span><span>&nbsp;</span><span>or</span><span>&nbsp;</span><span>low</span><span>&nbsp;</span><span>&lt;</span><span>&nbsp;</span><span>array.min</span><span>(</span><span>lows</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;We&nbsp;have&nbsp;at&nbsp;least&nbsp;4&nbsp;lows&nbsp;or&nbsp;price&nbsp;has&nbsp;breached&nbsp;t</span><span>he&nbsp;lowest&nbsp;low;</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;sort&nbsp;lows&nbsp;and&nbsp;set&nbsp;flag&nbsp;indicating&nbsp;we&nbsp;will&nbsp;plot&nbsp;</span><span>and&nbsp;flush&nbsp;the&nbsp;levels.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.sort</span><span>(</span><span>lows</span><span>,</span><span>&nbsp;</span><span>order.ascending</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>flushLows</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>true</span></span><br><span><span></span></span><br><span><span>//&nbsp;If&nbsp;needed,&nbsp;plot&nbsp;and&nbsp;flush&nbsp;lows.</span></span><br><span><span>lowLevel</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array_pop</span><span>(</span><span>lows</span><span>,</span><span>&nbsp;</span><span>flushLows</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>lowLevel</span><span>,</span><span>&nbsp;</span><span>"Low&nbsp;1"</span><span>,</span><span>&nbsp;</span><span>low</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>lowLevel</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>color.silver</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>color.purple</span><span>,</span><span>&nbsp;</span><span>2</span><span>,</span><span>&nbsp;</span><span>plot.style_linebr</span><span>)</span></span><br><span><span>lowLevel</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>array_pop</span><span>(</span><span>lows</span><span>,</span><span>&nbsp;</span><span>flushLows</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>lowLevel</span><span>,</span><span>&nbsp;</span><span>"Low&nbsp;2"</span><span>,</span><span>&nbsp;</span><span>low</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>lowLevel</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>color.silver</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>color.purple</span><span>,</span><span>&nbsp;</span><span>3</span><span>,</span><span>&nbsp;</span><span>plot.style_linebr</span><span>)</span></span><br><span><span>lowLevel</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>array_pop</span><span>(</span><span>lows</span><span>,</span><span>&nbsp;</span><span>flushLows</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>lowLevel</span><span>,</span><span>&nbsp;</span><span>"Low&nbsp;3"</span><span>,</span><span>&nbsp;</span><span>low</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>lowLevel</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>color.silver</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>color.purple</span><span>,</span><span>&nbsp;</span><span>4</span><span>,</span><span>&nbsp;</span><span>plot.style_linebr</span><span>)</span></span><br><span><span>lowLevel</span><span>&nbsp;</span><span>:=</span><span>&nbsp;</span><span>array_pop</span><span>(</span><span>lows</span><span>,</span><span>&nbsp;</span><span>flushLows</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>lowLevel</span><span>,</span><span>&nbsp;</span><span>"Low&nbsp;4"</span><span>,</span><span>&nbsp;</span><span>low</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>lowLevel</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>color.silver</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>color.purple</span><span>,</span><span>&nbsp;</span><span>5</span><span>,</span><span>&nbsp;</span><span>plot.style_linebr</span><span>)</span></span><br><span><span></span></span><br><span><span>if</span><span>&nbsp;</span><span>flushLows</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Clear&nbsp;remaining&nbsp;levels&nbsp;after&nbsp;the&nbsp;last&nbsp;4&nbsp;have&nbsp;be</span><span>en&nbsp;plotted.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>lows</span><span>.</span><span>clear</span><span>()</span></span><br><span><span></span></span><br>
```

### [Using an array as a queue](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id12)

Queues are FIFO (first in, first out) constructions. They behave somewhat like cars arriving at a red light. New cars are queued at the end of the line, and the first car to leave will be the first one that arrived to the red light.

In the following code example, we let users decide through the script’s inputs how many labels they want to have on their chart. We use that quantity to determine the size of the array of labels we then create, initializing the array’s elements to `na`.

When a new pivot is detected, we create a label for it, saving the label’s ID in the `pLabel` variable. We then queue the ID of that label by using [array.push()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}push) to append the new label’s ID to the end of the array, making our array size one greater than the maximum number of labels to keep on the chart.

Lastly, we de-queue the oldest label by removing the array’s first element using [array.shift()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}shift) and deleting the label referenced by that array element’s value. As we have now de-queued an element from our queue, the array contains `pivotCountInput` elements once again. Note that on the dataset’s first bars we will be deleting `na` label IDs until the maximum number of labels has been created, but this does not cause runtime errors. Let’s look at our code:

![../_images/Arrays-InsertingAndRemovingArrayElements-ShowLastnHighPivots.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Arrays-InsertingAndRemovingArrayElements-ShowLastnHighPivots.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>MAX_LABELS</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>100</span></span><br><span><span>indicator</span><span>(</span><span>"Show&nbsp;Last&nbsp;n&nbsp;High&nbsp;Pivots"</span><span>,</span><span>&nbsp;</span><span>""</span><span>,</span><span>&nbsp;</span><span>true</span><span>,</span><span>&nbsp;</span><span>max_labels_count</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>MAX_LABELS</span><span>)</span></span><br><span><span></span></span><br><span><span>pivotCountInput</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.int</span><span>(</span><span>5</span><span>,</span><span>&nbsp;</span><span>"How&nbsp;many&nbsp;pivots&nbsp;to&nbsp;show"</span><span>,</span><span>&nbsp;</span><span>minval</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>maxval</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>MAX_LABELS</span><span>)</span></span><br><span><span>pivotLegsInput</span><span>&nbsp;&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.int</span><span>(</span><span>3</span><span>,</span><span>&nbsp;</span><span>"Pivot&nbsp;legs"</span><span>,</span><span>&nbsp;</span><span>minval</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>1</span><span>,</span><span>&nbsp;</span><span>maxval</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>5</span><span>)</span></span><br><span><span></span></span><br><span><span>//&nbsp;Create&nbsp;an&nbsp;array&nbsp;containing&nbsp;the&nbsp;user-selected&nbsp;ma</span><span>x&nbsp;count&nbsp;of&nbsp;label&nbsp;IDs.</span></span><br><span><span>var</span><span>&nbsp;</span><span>labelIds</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>label</span><span>&gt;(</span><span>pivotCountInput</span><span>)</span></span><br><span><span></span></span><br><span><span>pHi</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>ta.pivothigh</span><span>(</span><span>pivotLegsInput</span><span>,</span><span>&nbsp;</span><span>pivotLegsInput</span><span>)</span></span><br><span><span>if</span><span>&nbsp;</span><span>not</span><span>&nbsp;</span><span>na</span><span>(</span><span>pHi</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;New&nbsp;pivot&nbsp;found;&nbsp;plot&nbsp;its&nbsp;label&nbsp;`i_pivotLegs`&nbsp;b</span><span>ars&nbsp;back.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>pLabel</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>[</span><span>pivotLegsInput</span><span>]</span><span>,</span><span>&nbsp;</span><span>pHi</span><span>,</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>pHi</span><span>,</span><span>&nbsp;</span><span>format.mintick</span><span>)</span><span>,</span><span>&nbsp;</span><span>textcolor</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>color.white</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Queue&nbsp;the&nbsp;new&nbsp;label's&nbsp;ID&nbsp;by&nbsp;appending&nbsp;it&nbsp;to&nbsp;the</span><span>&nbsp;end&nbsp;of&nbsp;the&nbsp;array.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.push</span><span>(</span><span>labelIds</span><span>,</span><span>&nbsp;</span><span>pLabel</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;De-queue&nbsp;the&nbsp;oldest&nbsp;label&nbsp;ID&nbsp;from&nbsp;the&nbsp;queue&nbsp;and</span><span>&nbsp;delete&nbsp;the&nbsp;corresponding&nbsp;label.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.delete</span><span>(</span><span>array.shift</span><span>(</span><span>labelIds</span><span>))</span></span><br><span><span></span></span><br>
```

## [Calculations on arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id13)

While series variables can be viewed as a horizontal set of values stretching back in time, Pine Script™’s one-dimensional arrays can be viewed as vertical structures residing on each bar. As an array’s set of elements is not a time series, Pine Script™’s usual mathematical functions are not allowed on them. Special-purpose functions must be used to operate on all of an array’s values. The available functions are: [array.abs()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}abs), [array.avg()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}avg), [array.covariance()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}covariance), [array.min()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}min), [array.max()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}max), [array.median()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}median), [array.mode()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}mode), [array.percentile\_linear\_interpolation()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}percentile_linear_interpolation), [array.percentile\_nearest\_rank()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}percentile_nearest_rank), [array.percentrank()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}percentrank), [array.range()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}range), [array.standardize()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}standardize), [array.stdev()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}stdev), [array.sum()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}sum), [array.variance()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}variance).

Note that contrary to the usual mathematical functions in Pine Script™, those used on arrays do not return `na` when some of the values they calculate on have `na` values. There are a few exceptions to this rule:

-   When all array elements have `na` value or the array contains no elements, `na` is returned. `array.standardize()` however, will return an empty array.
-   `array.mode()` will return `na` when no mode is found.

## [Manipulating arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id14)

### [Concatenation](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id15)

Two arrays can be merged—or concatenated—using [array.concat()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}concat). When arrays are concatenated, the second array is appended to the end of the first, so the first array is modified while the second one remains intact. The function returns the array ID of the first array:

![../_images/Arrays-ManipulatingArrays-Concat.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Arrays-ManipulatingArrays-Concat.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"`array.concat()`"</span><span>)</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>b</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>b</span><span>,</span><span>&nbsp;</span><span>2</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>b</span><span>,</span><span>&nbsp;</span><span>3</span><span>)</span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.islast</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"BEFORE\na:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\nb:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>b</span><span>)</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.large</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>c</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.concat</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>b</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.push</span><span>(</span><span>c</span><span>,</span><span>&nbsp;</span><span>4</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"AFTER\na:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\nb:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>b</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\nc:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>c</span><span>)</span><span>,</span><span>&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.style_label_up</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.large</span><span>)</span></span><br><span><span></span></span><br>
```

### [Copying](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id16)

You can copy an array using [array.copy()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}copy). Here we copy the array `a` to a new array named `_b`:

![../_images/Arrays-ManipulatingArrays-Copy.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Arrays-ManipulatingArrays-Copy.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"`array.copy()`"</span><span>)</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.islast</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>b</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.copy</span><span>(</span><span>a</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.push</span><span>(</span><span>b</span><span>,</span><span>&nbsp;</span><span>2</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"a:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\nb:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>b</span><span>)</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.large</span><span>)</span></span><br><span><span></span></span><br>
```

Note that simply using `_b = a` in the previous example would not have copied the array, but only its ID. From thereon, both variables would point to the same array, so using either one would affect the same array.

### [Joining](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id17)

Use [array.join()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}join) to concatenate all of the elements in the array into a string and separate these elements with the specified separator:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>""</span><span>)</span></span><br><span><span>v1</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>string</span><span>&gt;(</span><span>10</span><span>,</span><span>&nbsp;</span><span>"test"</span><span>)</span></span><br><span><span>v2</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>string</span><span>&gt;(</span><span>10</span><span>,</span><span>&nbsp;</span><span>"test"</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>v2</span><span>,</span><span>&nbsp;</span><span>"test1"</span><span>)</span></span><br><span><span>v3</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new_float</span><span>(</span><span>5</span><span>,</span><span>&nbsp;</span><span>5</span><span>)</span></span><br><span><span>v4</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new_int</span><span>(</span><span>5</span><span>,</span><span>&nbsp;</span><span>5</span><span>)</span></span><br><span><span>l1</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>close</span><span>,</span><span>&nbsp;</span><span>array.join</span><span>(</span><span>v1</span><span>))</span></span><br><span><span>l2</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>close</span><span>,</span><span>&nbsp;</span><span>array.join</span><span>(</span><span>v2</span><span>,</span><span>&nbsp;</span><span>","</span><span>))</span></span><br><span><span>l3</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>close</span><span>,</span><span>&nbsp;</span><span>array.join</span><span>(</span><span>v3</span><span>,</span><span>&nbsp;</span><span>","</span><span>))</span></span><br><span><span>l4</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>close</span><span>,</span><span>&nbsp;</span><span>array.join</span><span>(</span><span>v4</span><span>,</span><span>&nbsp;</span><span>","</span><span>))</span></span><br><span><span></span></span><br>
```

### [Sorting](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id18)

Arrays containing “int” or “float” elements can be sorted in either ascending or descending order using [array.sort()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}sort). The `order` parameter is optional and defaults to [order.ascending](https://www.tradingview.com/pine-script-reference/v5/#var_order{dot}ascending). As all `array.*()` function arguments, it is qualified as “series”, so can be determined at runtime, as is done here. Note that in the example, which array is sorted is also determined at runtime:

![../_images/Arrays-ManipulatingArrays-Sort.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Arrays-ManipulatingArrays-Sort.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"`array.sort()`"</span><span>)</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>b</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>2</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>b</span><span>,</span><span>&nbsp;</span><span>4</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>b</span><span>,</span><span>&nbsp;</span><span>3</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>b</span><span>,</span><span>&nbsp;</span><span>5</span><span>)</span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.islast</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>barUp</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>close</span><span>&nbsp;</span><span>&gt;</span><span>&nbsp;</span><span>open</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.sort</span><span>(</span><span>barUp</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>a</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>b</span><span>,</span><span>&nbsp;</span><span>barUp</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>order.ascending</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>order.descending</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>"a&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>(</span><span>barUp</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>"is&nbsp;sorted&nbsp;▲:&nbsp;"</span><span>&nbsp;&nbsp;&nbsp;</span><span>:</span><span>&nbsp;</span><span>"is&nbsp;not&nbsp;sorted:&nbsp;"</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\n\n"</span><span>&nbsp;</span><span>+</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>"b&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>(</span><span>barUp</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>"is&nbsp;not&nbsp;sorted:&nbsp;"</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>"is&nbsp;sorted&nbsp;▼:&nbsp;"</span><span>)</span><span>&nbsp;&nbsp;&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>b</span><span>)</span><span>,</span><span>&nbsp;</span><span>size</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>size.large</span><span>)</span></span><br><span><span></span></span><br>
```

Another useful option for sorting arrays is to use the [array.sort\_indices()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}sort_indices) function, which takes a reference to the original array and returns an array containing the indices from the original array. Please note that this function won’t modify the original array. The `order` parameter is optional and defaults to [order.ascending](https://www.tradingview.com/pine-script-reference/v5/#var_order{dot}ascending).

### [Reversing](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id19)

Use [array.reverse()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}reverse) to reverse an array:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"`array.reverse()`"</span><span>)</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>2</span><span>)</span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.islast</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.reverse</span><span>(</span><span>a</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"a:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>))</span></span><br><span><span></span></span><br>
```

### [Slicing](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id20)

Slicing an array using [array.slice()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}slice) creates a shallow copy of a subset of the parent array. You determine the size of the subset to slice using the `index_from` and `index_to` parameters. The `index_to` argument must be one greater than the end of the subset you want to slice.

The shallow copy created by the slice acts like a window on the parent array’s content. The indices used for the slice define the window’s position and size over the parent array. If, as in the example below, a slice is created from the first three elements of an array (indices 0 to 2), then regardless of changes made to the parent array, and as long as it contains at least three elements, the shallow copy will always contain the parent array’s first three elements.

Additionally, once the shallow copy is created, operations on the copy are mirrored on the parent array. Adding an element to the end of the shallow copy, as is done in the following example, will widen the window by one element and also insert that element in the parent array at index 3. In this example, to slice the subset from index 0 to index 2 of array `a`, we must use `_sliceOfA = array.slice(a, 0, 3)`:

![../_images/Arrays-ManipulatingArrays-Slice.png](https://www.tradingview.com/pine-script-docs/en/v5/_images/Arrays-ManipulatingArrays-Slice.png)

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"`array.slice()`"</span><span>)</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>2</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>3</span><span>)</span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.islast</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Create&nbsp;a&nbsp;shadow&nbsp;of&nbsp;elements&nbsp;at&nbsp;index&nbsp;1&nbsp;and&nbsp;2&nbsp;fr</span><span>om&nbsp;array&nbsp;`a`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>sliceOfA</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.slice</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>3</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"BEFORE\na:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\nsliceOfA:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>sliceOfA</span><span>))</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Remove&nbsp;first&nbsp;element&nbsp;of&nbsp;parent&nbsp;array&nbsp;`a`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.remove</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>0</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;Add&nbsp;a&nbsp;new&nbsp;element&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;shallow&nbsp;cop</span><span>y,&nbsp;thus&nbsp;also&nbsp;affecting&nbsp;the&nbsp;original&nbsp;array&nbsp;`a`.</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.push</span><span>(</span><span>sliceOfA</span><span>,</span><span>&nbsp;</span><span>4</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"AFTER\na:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>"\nsliceOfA:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>sliceOfA</span><span>)</span><span>,</span><span>&nbsp;</span><span>style</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>label.style_label_up</span><span>)</span></span><br><span><span></span></span><br>
```

## [Searching arrays](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id21)

We can test if a value is part of an array with the [array.includes()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}includes) function, which returns true if the element is found. We can find the first occurrence of a value in an array by using the [array.indexof()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}indexof) function. The first occurence is the one with the lowest index. We can also find the last occurrence of a value with [array.lastindexof()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}lastindexof):

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Searching&nbsp;in&nbsp;arrays"</span><span>)</span></span><br><span><span>valueInput</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.int</span><span>(</span><span>1</span><span>)</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>0</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>2</span><span>)</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>if</span><span>&nbsp;</span><span>barstate.islast</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>valueFound</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.includes</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>valueInput</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>firstIndexFound</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.indexof</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>valueInput</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>lastIndexFound</span><span>&nbsp;&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.lastindexof</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>valueInput</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"a:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>)</span><span>&nbsp;</span><span>+</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>"\nFirst&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>valueInput</span><span>)</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>(</span><span>firstIndexFound</span><span>&nbsp;</span><span>!=</span><span>&nbsp;</span><span>-1</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>"&nbsp;value&nbsp;was&nbsp;found&nbsp;at&nbsp;index:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>firstIndexFound</span><span>)</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>"&nbsp;value&nbsp;was&nbsp;not&nbsp;found."</span><span>)</span><span>&nbsp;</span><span>+</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>"\nLast&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>valueInput</span><span>)</span><span>&nbsp;&nbsp;</span><span>+</span><span>&nbsp;</span><span>(</span><span>lastIndexFound</span><span>&nbsp;&nbsp;</span><span>!=</span><span>&nbsp;</span><span>-1</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>"&nbsp;value&nbsp;was&nbsp;found&nbsp;at&nbsp;index:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>lastIndexFound</span><span>)</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>"&nbsp;value&nbsp;was&nbsp;not&nbsp;found."</span><span>))</span></span><br><span><span></span></span><br>
```

We can also perform a binary search on an array but note that performing a binary search on an array means that the array will first need to be sorted in ascending order only. The [array.binary\_search()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}binary_search) function will return the value’s index if it was found or -1 if it wasn’t. If we want to always return an existing index from the array even if our chosen value wasn’t found, then we can use one of the other binary search functions available. The [array.binary\_search\_leftmost()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}binary_search_leftmost) function, which returns an index if the value was found or the first index to the left where the value would be found. The [array.binary\_search\_rightmost()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}binary_search_rightmost) function is almost identical and returns an index if the value was found or the first index to the right where the value would be found.

## [Error handling](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id22)

Malformed `array.*()` call syntax in Pine scripts will cause the usual **compiler** error messages to appear in Pine Editor’s console, at the bottom of the window, when you save a script. Refer to the Pine Script™ [v5 Reference Manual](https://www.tradingview.com/pine-script-reference/v5/) when in doubt regarding the exact syntax of function calls.

Scripts using arrays can also throw **runtime** errors, which appear as an exclamation mark next to the indicator’s name on the chart. We discuss those runtime errors in this section.

### [Index xx is out of bounds. Array size is yy](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id23)

This will most probably be the most frequent error you encounter. It will happen when you reference an nonexistent array index. The “xx” value will be the value of the faulty index you tried to use, and “yy” will be the size of the array. Recall that array indices start at zero—not one—and end at the array’s size, minus one. An array of size 3’s last valid index is thus `2`.

To avoid this error, you must make provisions in your code logic to prevent using an index lying outside of the array’s index boundaries. This code will generate the error because the last index we use in the loop is outside the valid index range for the array:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Out&nbsp;of&nbsp;bounds&nbsp;index"</span><span>)</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>3</span><span>)</span></span><br><span><span>for</span><span>&nbsp;</span><span>i</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>1</span><span>&nbsp;</span><span>to</span><span>&nbsp;</span><span>3</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.set</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>i</span><span>,</span><span>&nbsp;</span><span>i</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>array.pop</span><span>(</span><span>a</span><span>))</span></span><br><span><span></span></span><br>
```

The correct `for` statement is:

To loop on all array elements in an array of unknown size, use:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Protected&nbsp;`for`&nbsp;loop"</span><span>)</span></span><br><span><span>sizeInput</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.int</span><span>(</span><span>0</span><span>,</span><span>&nbsp;</span><span>"Array&nbsp;size"</span><span>,</span><span>&nbsp;</span><span>minval</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>maxval</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>100000</span><span>)</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>sizeInput</span><span>)</span></span><br><span><span>for</span><span>&nbsp;</span><span>i</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>0</span><span>&nbsp;</span><span>to</span><span>&nbsp;</span><span>(</span><span>array.size</span><span>(</span><span>a</span><span>)</span><span>&nbsp;</span><span>==</span><span>&nbsp;</span><span>0</span><span>&nbsp;</span><span>?</span><span>&nbsp;</span><span>na</span><span>&nbsp;</span><span>:</span><span>&nbsp;</span><span>array.size</span><span>(</span><span>a</span><span>)</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>1</span><span>)</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.set</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>i</span><span>,</span><span>&nbsp;</span><span>i</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>array.pop</span><span>(</span><span>a</span><span>))</span></span><br><span><span></span></span><br>
```

When you size arrays dynamically using a field in your script’s _Settings/Inputs_ tab, protect the boundaries of that value using [input.int()](https://www.tradingview.com/pine-script-reference/v5/#fun_input{dot}int)’s `minval` and `maxval` parameters:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Protected&nbsp;array&nbsp;size"</span><span>)</span></span><br><span><span>sizeInput</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>input.int</span><span>(</span><span>10</span><span>,</span><span>&nbsp;</span><span>"Array&nbsp;size"</span><span>,</span><span>&nbsp;</span><span>minval</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>1</span><span>,</span><span>&nbsp;</span><span>maxval</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>100000</span><span>)</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>sizeInput</span><span>)</span></span><br><span><span>for</span><span>&nbsp;</span><span>i</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>0</span><span>&nbsp;</span><span>to</span><span>&nbsp;</span><span>sizeInput</span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span>1</span></span><br><span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>array.set</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>i</span><span>,</span><span>&nbsp;</span><span>i</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>array.size</span><span>(</span><span>a</span><span>))</span></span><br><span><span></span></span><br>
```

See the [Looping](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#pagearrays-looping) section of this page for more information.

### [Cannot call array methods when ID of array is ‘na’](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id24)

When an array ID is initialized to `na`, operations on it are not allowed, since no array exists. All that exists at that point is an array variable containing the `na` value rather that a valid array ID pointing to an existing array. Note that an array created with no elements in it, as you do when you use `a = array.new_int(0)`, has a valid ID nonetheless. This code will throw the error we are discussing:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Out&nbsp;of&nbsp;bounds&nbsp;index"</span><span>)</span></span><br><span><span>array</span><span>&lt;</span><span>int</span><span>&gt;</span><span>&nbsp;</span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>na</span></span><br><span><span>array.push</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>111</span><span>)</span></span><br><span><span>label.new</span><span>(</span><span>bar_index</span><span>,</span><span>&nbsp;</span><span>0</span><span>,</span><span>&nbsp;</span><span>"a:&nbsp;"</span><span>&nbsp;</span><span>+</span><span>&nbsp;</span><span>str.tostring</span><span>(</span><span>a</span><span>))</span></span><br><span><span></span></span><br>
```

To avoid it, create an array with size zero using:

```
<span><span>array</span><span>&lt;</span><span>int</span><span>&gt;</span><span>&nbsp;</span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new_int</span><span>(</span><span>0</span><span>)</span></span><br><span><span></span></span><br>
```

or:

### [Array is too large. Maximum size is 100000](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id25)

This error will appear if your code attempts to declare an array with a size greater than 100,000. It will also occur if, while dynamically appending elements to an array, a new element would increase the array’s size past the maximum.

### [Cannot create an array with a negative size](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id26)

We haven’t found any use for arrays of negative size yet, but if you ever do, we may allow them :)

### [Cannot use shift() if array is empty.](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id27)

This error will occur if [array.shift()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}shift) is called to remove the first element of an empty array.

### [Cannot use pop() if array is empty.](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id28)

This error will occur if [array.pop()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}pop) is called to remove the last element of an empty array.

### [Index ‘from’ should be less than index ‘to’](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id29)

When two indices are used in functions such as [array.slice()](https://www.tradingview.com/pine-script-reference/v5/#fun_array{dot}slice), the first index must always be smaller than the second one.

### [Slice is out of bounds of the parent array](https://www.tradingview.com/pine-script-docs/en/v5/language/Arrays.html#id30)

This message occurs whenever the parent array’s size is modified in such a way that it makes the shallow copy created by a slice point outside the boundaries of the parent array. This code will reproduce it because after creating a slice from index 3 to 4 (the last two elements of our five-element parent array), we remove the parent’s first element, making its size four and its last index 3. From that moment on, the shallow copy which is still poiting to the “window” at the parent array’s indices 3 to 4, is pointing out of the parent array’s boundaries:

```
<span><span>//</span><span>@version=5</span></span><br><span><span>indicator</span><span>(</span><span>"Slice&nbsp;out&nbsp;of&nbsp;bounds"</span><span>)</span></span><br><span><span>a</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.new</span><span>&lt;</span><span>float</span><span>&gt;(</span><span>5</span><span>,</span><span>&nbsp;</span><span>0</span><span>)</span></span><br><span><span>b</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.slice</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>3</span><span>,</span><span>&nbsp;</span><span>5</span><span>)</span></span><br><span><span>array.remove</span><span>(</span><span>a</span><span>,</span><span>&nbsp;</span><span>0</span><span>)</span></span><br><span><span>c</span><span>&nbsp;</span><span>=</span><span>&nbsp;</span><span>array.indexof</span><span>(</span><span>b</span><span>,</span><span>&nbsp;</span><span>2</span><span>)</span></span><br><span><span>plot</span><span>(</span><span>c</span><span>)</span></span><br><span><span></span></span><br>
```

[

![../_images/TradingView_Logo_Block.svg](https://www.tradingview.com/pine-script-docs/en/v5/_images/TradingView_Logo_Block.svg)

](https://www.tradingview.com/)